(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.4' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    144193,       3824]
NotebookOptionsPosition[    139908,       3753]
NotebookOutlinePosition[    140310,       3769]
CellTagsIndexPosition[    140267,       3766]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Crowd Escape Panic Model", "Title",
 CellChangeTimes->{{3.776600831050974*^9, 3.7766008318453026`*^9}, {
  3.776716385892248*^9, 3.7767163898738484`*^9}, {3.776716551386162*^9, 
  3.7767165575816903`*^9}, {3.776716932379567*^9, 
  3.7767169360051517`*^9}},ExpressionUUID->"9805899a-93c0-4bc4-9545-\
29f957ca3701"],

Cell["Adam Rumpf, 5/1/2018", "Text",
 CellChangeTimes->{{3.7766008347881403`*^9, 3.776600838290375*^9}, {
  3.7767164096961517`*^9, 
  3.7767164112664833`*^9}},ExpressionUUID->"5c85a689-ec56-4fd6-a6a0-\
10104880b1a6"],

Cell[CellGroupData[{

Cell["Introduction", "Section",
 CellChangeTimes->{{3.7766008459498987`*^9, 
  3.776600848547045*^9}},ExpressionUUID->"df1c84b3-b1e1-4f24-abd9-\
57ce7640212f"],

Cell["Based on the following paper:", "Text",
 CellChangeTimes->{{3.776600856235587*^9, 3.776600860481224*^9}, {
  3.776717137261506*^9, 
  3.7767171483543005`*^9}},ExpressionUUID->"2db01df3-4a50-4871-bf2e-\
a82f32323fdc"],

Cell[TextData[{
 "D. Helbing, I. Farkas, and T. Vicsek. Simulating dynamical features of \
escape panic. ",
 StyleBox["Nature",
  FontSlant->"Italic"],
 ", 407:487\[LongDash]490, 2000."
}], "Text",
 CellChangeTimes->{{3.776600856235587*^9, 3.776600860481224*^9}, {
  3.776717137261506*^9, 
  3.776717152796668*^9}},ExpressionUUID->"f51dcc4f-94c0-4737-803e-\
0cdc6a17e919"],

Cell["\<\
The paper describes a dynamical systems model (see below for a full \
definition) for crowds of people running to an exit. The model consists of a \
system of ODEs based on the forces of people acting on each other. This \
program solves the ODEs using forward Euler\[CloseCurlyQuote]s method.\
\>", "Text",
 CellChangeTimes->{{3.776717166514436*^9, 3.776717167632295*^9}, {
  3.7767197161509967`*^9, 3.776719813705699*^9}, {3.77672033530317*^9, 
  3.7767203497579947`*^9}},ExpressionUUID->"54748ff5-887e-4436-85f5-\
117a32376125"],

Cell["\<\
This demonstration consists mostly of a single Manipulate environment to \
produce an animation of a crowd attempting to escape a building. People are \
represented as randomly-sized dots. The color of the dot represents the \
amount of crush force experienced, with redder color indicating more force, \
which a planner would ideally like to avoid since this can lead to injury. A \
time series is also displayed in the lower right corner, with the green \
series indicating number of successful escapes (which occurs when a dot \
crosses the threshold of the exit) and the red series indicating total force.\
\>", "Text",
 CellChangeTimes->{{3.776719828336033*^9, 
  3.7767199711270523`*^9}},ExpressionUUID->"d23009bc-4c8e-4b0e-b829-\
f5f80bcaf679"],

Cell["\<\
There are also controls to change the layout of the room and the size and \
behavior of the people. Due to the computational intensity of this program \
changes are not applied in real time, and are instead applied by pressing the \
\[OpenCurlyDoubleQuote]apply changes\[CloseCurlyDoubleQuote] button, at which \
point the simulation will restart with the new parameters. Before applying \
the changes, the prospective layout is drawn over the current layout in a \
gray outline. This button can also be pressed even without applying changes \
simply to randomly restart the simulation with different starting positions.\
\>", "Text",
 CellChangeTimes->{{3.7767199785696683`*^9, 3.776720048478415*^9}, {
  3.776720086455348*^9, 
  3.776720145692374*^9}},ExpressionUUID->"9a797aee-a68f-4739-ac0b-\
aeaad9fb9810"]
}, Open  ]],

Cell[CellGroupData[{

Cell["ODE Model", "Section",
 CellChangeTimes->{{3.7767171834275007`*^9, 
  3.776717186634338*^9}},ExpressionUUID->"5df14828-0346-4594-be8c-\
36a8fe364a93"],

Cell[CellGroupData[{

Cell["Notation", "Subsection",
 CellChangeTimes->{{3.776717255983509*^9, 
  3.7767172568825264`*^9}},ExpressionUUID->"c8837db3-3e26-4009-a6c1-\
fa94a6130bfc"],

Cell[TextData[{
 Cell[BoxData[
  FormBox["t", TraditionalForm]],ExpressionUUID->
  "eab38c59-499f-4745-a63c-272f4b32c7eb"],
 " = time\n",
 Cell[BoxData[
  FormBox["N", TraditionalForm]],ExpressionUUID->
  "b45a659c-299d-48d4-bf31-a36f3f58efb2"],
 " = number of pedestrians\n",
 Cell[BoxData[
  FormBox[
   SubscriptBox["m", "i"], TraditionalForm]],ExpressionUUID->
  "c0d4cbfd-bbd4-44c0-8db9-ea1f5e05d15b"],
 " = mass of pedestrian ",
 Cell[BoxData[
  FormBox["i", TraditionalForm]],ExpressionUUID->
  "674debeb-275e-4c10-ac83-b7a65244677a"],
 "\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SuperscriptBox[
     SubscriptBox["v", "i"], "0"], "(", "t", ")"}], TraditionalForm]],
  ExpressionUUID->"1fcb3fb9-a9b5-4f00-afe9-38cd7d0f3bc5"],
 " = desired speed of pedestrian ",
 Cell[BoxData[
  FormBox["i", TraditionalForm]],ExpressionUUID->
  "ca18a9f5-ecdf-42f4-9365-02513554f785"],
 " at time ",
 Cell[BoxData[
  FormBox["t", TraditionalForm]],ExpressionUUID->
  "1e26fa2e-ae3a-404c-9981-1b9ddfef3e0a"],
 "\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SuperscriptBox[
     SubscriptBox[
      OverscriptBox["e", "\[RightVector]"], "i"], "0"], "(", "t", ")"}], 
   TraditionalForm]],ExpressionUUID->"f78e481f-cd81-4fd3-8fa8-5857a126fc0a"],
 " = desired direction of pedestrian ",
 Cell[BoxData[
  FormBox["i", TraditionalForm]],ExpressionUUID->
  "ba43a921-9664-4729-88a8-1a0bc9eca31a"],
 " at time ",
 Cell[BoxData[
  FormBox["t", TraditionalForm]],ExpressionUUID->
  "768c1ea1-7e4b-4533-9e28-1acc92ac2edb"],
 "\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox[
     OverscriptBox["v", "\[RightVector]"], "i"], "(", "t", ")"}], 
   TraditionalForm]],ExpressionUUID->"42b8332f-555b-4c22-9d01-baad66f0c8df"],
 " = actual velocity of pedestrian ",
 Cell[BoxData[
  FormBox["i", TraditionalForm]],ExpressionUUID->
  "8592f82a-6ec3-4d02-a733-9ba04f9eff61"],
 " at time ",
 Cell[BoxData[
  FormBox["t", TraditionalForm]],ExpressionUUID->
  "0ea4efac-3030-457e-8ff5-ec84fe6e5978"],
 "\n",
 Cell[BoxData[
  FormBox[
   SubscriptBox["\[Tau]", "i"], TraditionalForm]],ExpressionUUID->
  "8f50b169-60aa-4fd2-a71e-28e10669a9be"],
 " = characteristic time for pedestrian ",
 Cell[BoxData[
  FormBox["i", TraditionalForm]],ExpressionUUID->
  "cd84a459-b10e-4c23-934c-589abb7dfd26"],
 " (time taken for actual velocity to match desired velocity)\n",
 Cell[BoxData[
  FormBox["W", TraditionalForm]],ExpressionUUID->
  "51573a99-a468-4f92-a577-ab6ca34af0a2"],
 " = set of walls\n",
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["f", "\[RightVector]"], "ij"], TraditionalForm]],
  ExpressionUUID->"f3742b03-37a2-4f0c-8a34-6a2224dc008a"],
 " = interaction force between pedestrians ",
 Cell[BoxData[
  FormBox["i", TraditionalForm]],ExpressionUUID->
  "398e1b5d-7719-469b-b079-5ca1515ac0a7"],
 " and ",
 Cell[BoxData[
  FormBox["j", TraditionalForm]],ExpressionUUID->
  "d1137511-f1a8-4eff-8d08-829e9f9ed701"],
 "\n",
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["f", "\[RightVector]"], "iW"], TraditionalForm]],
  ExpressionUUID->"e5860b8f-8426-4f68-b69d-770281e7ed17"],
 " = interaction force between pedestrian ",
 Cell[BoxData[
  FormBox["i", TraditionalForm]],ExpressionUUID->
  "a9a2f8b1-5319-4760-8f0e-07f3d7c3f059"],
 " and wall ",
 Cell[BoxData[
  FormBox["W", TraditionalForm]],ExpressionUUID->
  "40715d78-f148-49b2-a8d9-0dee486f1bf5"],
 "\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox[
     OverscriptBox["r", "\[RightVector]"], "i"], "(", "t", ")"}], 
   TraditionalForm]],ExpressionUUID->"15e8fbac-070a-4516-bf2a-3fc2bf972b96"],
 " = position of pedestrian ",
 Cell[BoxData[
  FormBox["i", TraditionalForm]],ExpressionUUID->
  "c5e06123-201f-414a-a94f-d485d97a17f1"],
 " at time ",
 Cell[BoxData[
  FormBox["t", TraditionalForm]],ExpressionUUID->
  "12cc6d2d-5d82-4be2-adba-c7c8dabc6b68"],
 "\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["A", "i"], ",", 
    SubscriptBox["B", "i"]}], TraditionalForm]],ExpressionUUID->
  "934c0d37-9490-4cfe-b7eb-5e1f8740b635"],
 " = constants describing the repulsive interaction force acting on \
pedestrian ",
 Cell[BoxData[
  FormBox["i", TraditionalForm]],ExpressionUUID->
  "84151932-6beb-41dd-b5dd-2d7441f26f76"],
 "\n",
 Cell[BoxData[
  FormBox[
   SubscriptBox["d", "ij"], TraditionalForm]],ExpressionUUID->
  "335e0108-5512-47e4-9343-3fedc7ac5452"],
 " = distance between pedestrian ",
 Cell[BoxData[
  FormBox["i", TraditionalForm]],ExpressionUUID->
  "0051c5b3-604a-4a3c-82a6-4edda51ac4e2"],
 " and ",
 Cell[BoxData[
  FormBox["j", TraditionalForm]],ExpressionUUID->
  "b0556ad8-f52d-469c-8a45-6217cbc58337"],
 "\[CloseCurlyQuote]s centers of mass\n",
 Cell[BoxData[
  FormBox[
   SubscriptBox["d", "iW"], TraditionalForm]],ExpressionUUID->
  "3b708d1e-5434-488a-bff3-1c4346ae80df"],
 " = distance between pedestrian ",
 Cell[BoxData[
  FormBox["i", TraditionalForm]],ExpressionUUID->
  "175eeedd-8d0b-4e76-9f07-82f6c3c1d5fc"],
 " and wall ",
 Cell[BoxData[
  FormBox["W", TraditionalForm]],ExpressionUUID->
  "059baa43-9cfc-41cb-8ea8-1e0e2b1960fe"],
 "\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox[
     OverscriptBox["n", "\[RightVector]"], "ij"], "=", 
    RowBox[{"(", 
     RowBox[{
      SuperscriptBox[
       SubscriptBox["n", "ij"], "1"], ",", 
      SuperscriptBox[
       SubscriptBox["n", "ij"], "2"]}], ")"}]}], TraditionalForm]],
  ExpressionUUID->"301c1cca-7aed-41e1-b9ca-b3a5e5a85749"],
 " = normalized vector pointing from pedestrian ",
 Cell[BoxData[
  FormBox["j", TraditionalForm]],ExpressionUUID->
  "10a98533-2c6c-4e4a-9075-34288196d848"],
 " to ",
 Cell[BoxData[
  FormBox["i", TraditionalForm]],ExpressionUUID->
  "6005be65-3c59-4db2-b4ab-93f9eb787e75"],
 "\n",
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["n", "\[RightVector]"], "iW"], TraditionalForm]],
  ExpressionUUID->"02966412-2a30-4bee-8829-1919ed78d7bb"],
 " = direction perpendicular to wall ",
 Cell[BoxData[
  FormBox["W", TraditionalForm]],ExpressionUUID->
  "fd9f4b87-f6a8-46bc-9bde-9e060b6907b1"],
 "\n",
 Cell[BoxData[
  FormBox[
   SubscriptBox["r", "i"], TraditionalForm]],ExpressionUUID->
  "c90e66f6-db94-43f4-b732-d511f163356a"],
 " = radius of pedestrian ",
 Cell[BoxData[
  FormBox["i", TraditionalForm]],ExpressionUUID->
  "4a42f264-a1ef-40e7-a1c9-48fd4f6543d6"],
 "\n",
 Cell[BoxData[
  FormBox[
   SubscriptBox["r", "ij"], TraditionalForm]],ExpressionUUID->
  "5ff93e26-9293-452a-97b9-83c8bc5a1968"],
 " = sum of radii of pedestrians ",
 Cell[BoxData[
  FormBox["i", TraditionalForm]],ExpressionUUID->
  "04129d61-45e9-40e5-af69-a45feb0c2da5"],
 " and ",
 Cell[BoxData[
  FormBox["j", TraditionalForm]],ExpressionUUID->
  "0ab9d65c-7f68-4c88-9fc0-910882f4d4f8"],
 "\n",
 Cell[BoxData[
  FormBox[
   RowBox[{"k", ",", "\[Kappa]"}], TraditionalForm]],ExpressionUUID->
  "fb5a952f-a007-4aa4-9956-6dc46c4c4b42"],
 " = large constants that control body force and sliding friction, \
respectively\n",
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["t", "\[RightVector]"], "ij"], TraditionalForm]],
  ExpressionUUID->"c2116609-f51a-484b-a2d0-ff1c8c35eb88"],
 " = tangential direction between pedestrians ",
 Cell[BoxData[
  FormBox["i", TraditionalForm]],ExpressionUUID->
  "0f53c75f-0b2e-4f21-b154-e07d90dd897b"],
 " and ",
 Cell[BoxData[
  FormBox["j", TraditionalForm]],ExpressionUUID->
  "e6ebc910-2292-4944-9478-9e807e877639"],
 "\n",
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["t", "\[RightVector]"], "iW"], TraditionalForm]],
  ExpressionUUID->"309e6428-8a3d-4da1-ad19-b9562ec20510"],
 " = direction tangential to wall ",
 Cell[BoxData[
  FormBox["W", TraditionalForm]],ExpressionUUID->
  "2f361818-a4a1-48da-9f4e-2b0187eb7e71"],
 "\n",
 Cell[BoxData[
  FormBox[
   SuperscriptBox[
    SubscriptBox["\[CapitalDelta]v", "ij"], "t"], TraditionalForm]],
  ExpressionUUID->"b4174ae2-4de0-4e52-82f3-a12c374b7dcf"],
 " = difference in tangential velocities of pedestrians ",
 Cell[BoxData[
  FormBox["i", TraditionalForm]],ExpressionUUID->
  "8b3ff0ff-69e3-434b-a761-30454dd97762"],
 " and ",
 Cell[BoxData[
  FormBox["j", TraditionalForm]],ExpressionUUID->
  "82836a17-1865-4dcb-88be-3a716ad3934e"],
 "\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"g", "(", "x", ")"}], "=", 
    RowBox[{"{", 
     RowBox[{GridBox[{
        {"0", 
         RowBox[{
          RowBox[{"if", " ", "x"}], "<", "0"}]},
        {"x", 
         RowBox[{
          RowBox[{"if", " ", "x"}], "\[GreaterEqual]", "0"}]}
       }], "=", 
      RowBox[{"max", 
       RowBox[{"{", 
        RowBox[{"0", ",", "x"}], "}"}]}]}]}]}], TraditionalForm]],
  ExpressionUUID->"e85c9b62-02eb-4dd7-af1b-aeb9e1d2fd27"],
 " = function to zero out negative arguments"
}], "Text",
 CellChangeTimes->{{3.7767171907543736`*^9, 3.776717249892484*^9}, {
  3.874358733114093*^9, 
  3.874358738607667*^9}},ExpressionUUID->"86acbcdb-3236-4447-b19c-\
8f67ddabbf86"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Estimated Parameters", "Subsection",
 CellChangeTimes->{{3.776717291936208*^9, 
  3.776717297689221*^9}},ExpressionUUID->"906c993f-7cf7-413d-8a1f-\
5764b1bb7ebc"],

Cell[TextData[{
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["m", "i"], "=", 
    RowBox[{"80", "kg"}]}], TraditionalForm]],ExpressionUUID->
  "caad93ef-b5fc-43dc-8b20-f1d57f322d01"],
 "\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SuperscriptBox[
     SubscriptBox["v", "i"], "0"], "=", 
    RowBox[{"1", 
     FractionBox["m", "s"]}]}], TraditionalForm]],ExpressionUUID->
  "8e44a551-482d-41e8-8968-c8fb552df2f4"],
 " , which corresponds to the paper\[CloseCurlyQuote]s \
\[OpenCurlyDoubleQuote]normal\[CloseCurlyDoubleQuote] conditions\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Tau]", "i"], "=", 
    RowBox[{"0.5", "s"}]}], TraditionalForm]],ExpressionUUID->
  "098e11f9-ee46-4fcd-afb3-d3c2748b9af2"],
 "\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["A", "i"], "=", 
    RowBox[{"2", "\[Times]", 
     SuperscriptBox["10", "3"], "N"}]}], TraditionalForm]],ExpressionUUID->
  "2cc3e0e8-9d5c-4323-a65f-857d8451627c"],
 "\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["B", "i"], "=", 
    RowBox[{"0.08", "m"}]}], TraditionalForm]],ExpressionUUID->
  "4edbaf6f-d88f-4a69-a34f-e2af125c4b7b"],
 "\n",
 Cell[BoxData[
  FormBox[
   RowBox[{"k", "=", 
    RowBox[{"1.2", "\[Times]", 
     SuperscriptBox["10", "5"], 
     FractionBox["kg", 
      SuperscriptBox["s", "2"]]}]}], TraditionalForm]],ExpressionUUID->
  "6bb73e2b-ca78-4a8a-b86f-8e2f3de922b4"],
 "\n",
 Cell[BoxData[
  FormBox[
   RowBox[{"\[Kappa]", "=", 
    RowBox[{"2.4", "\[Times]", 
     SuperscriptBox["10", "5"], 
     FractionBox["kg", 
      RowBox[{"m", " ", "s"}]]}]}], TraditionalForm]],ExpressionUUID->
  "cc48bff5-678b-44d1-be7b-d8a1a09fa9fc"],
 "\n",
 Cell[BoxData[
  FormBox[
   RowBox[{"2", 
    RowBox[{
     SubscriptBox["r", "i"], "~", 
     RowBox[{"U", "[", 
      RowBox[{
       RowBox[{"0.5", "m"}], ",", 
       RowBox[{"0.7", "m"}]}], "]"}]}]}], TraditionalForm]],ExpressionUUID->
  "686c9150-ce73-4a83-bc8f-fd4c8e2a4b30"]
}], "Text",
 CellChangeTimes->{{3.7767173053782897`*^9, 
  3.7767173428142323`*^9}},ExpressionUUID->"9d4489d2-30b4-47b8-a5cb-\
ac898d8d73ba"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Model Definition", "Subsection",
 CellChangeTimes->{{3.776717265068303*^9, 
  3.776717272637017*^9}},ExpressionUUID->"38fa2ada-9ae7-40e1-992c-\
07925d72e6b4"],

Cell[TextData[{
 "The change in pedestrian ",
 Cell[BoxData[
  FormBox["i", TraditionalForm]],ExpressionUUID->
  "88648179-96af-427d-ba2a-e50b1d46c12c"],
 "\[CloseCurlyQuote]s velocity at time ",
 Cell[BoxData[
  FormBox["t", TraditionalForm]],ExpressionUUID->
  "50aca9d6-f6a4-4255-8492-b380ca1d3f2c"],
 " is given by the acceleration equation"
}], "Text",
 CellChangeTimes->{
  3.7767172377664404`*^9, {3.776717397554256*^9, 
   3.776717401793109*^9}},ExpressionUUID->"9c3fc9b8-2227-4d89-b23f-\
2eba5055ffc4"],

Cell[BoxData[
 FormBox[
  RowBox[{
   RowBox[{
    SubscriptBox["m", "i"], 
    FractionBox[
     RowBox[{"\[DifferentialD]", 
      SubscriptBox[
       OverscriptBox["v", "\[RightVector]"], "i"]}], 
     RowBox[{"\[DifferentialD]", "t"}]]}], "=", 
   RowBox[{
    RowBox[{
     SubscriptBox["m", "i"], 
     FractionBox[
      RowBox[{
       RowBox[{
        SuperscriptBox[
         SubscriptBox["v", "i"], "0"], 
        RowBox[{"(", "t", ")"}], " ", 
        RowBox[{
         SuperscriptBox[
          SubscriptBox[
           OverscriptBox["e", "\[RightVector]"], "i"], "0"], "(", "t", 
         ")"}]}], "-", 
       RowBox[{
        SubscriptBox[
         OverscriptBox["v", "\[RightVector]"], "i"], "(", "t", ")"}]}], 
      SubscriptBox["\[Tau]", "i"]]}], "+", 
    RowBox[{
     UnderscriptBox["\[Sum]", 
      RowBox[{"j", "(", 
       RowBox[{"\[NotEqual]", "i"}], ")"}]], 
     SubscriptBox[
      OverscriptBox["f", "\[RightVector]"], "ij"]}], "+", 
    RowBox[{
     UnderscriptBox["\[Sum]", "W"], 
     SubscriptBox[
      OverscriptBox["f", "\[RightVector]"], "iW"]}]}]}], 
  TraditionalForm]], "DisplayFormula",
 CellChangeTimes->{
  3.7767172377664404`*^9, {3.776717397554256*^9, 
   3.776717420150271*^9}},ExpressionUUID->"476f0db7-f658-40b0-8456-\
20e2388a2684"],

Cell[TextData[{
 "Velocity is change in position, so by definition ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    FractionBox[
     RowBox[{"\[DifferentialD]", 
      SubscriptBox[
       OverscriptBox["r", "\[RightVector]"], "i"]}], 
     RowBox[{"\[DifferentialD]", "t"}]], "=", 
    RowBox[{
     SubscriptBox[
      OverscriptBox["v", "\[RightVector]"], "i"], "(", "t", ")"}]}], 
   TraditionalForm]],ExpressionUUID->"896410e7-7fb8-4688-9e2d-019358b2e5be"],
 "."
}], "Text",
 CellChangeTimes->{
  3.7767172377664404`*^9, {3.776717397554256*^9, 3.776717450738205*^9}, {
   3.776719148617407*^9, 
   3.7767191506667504`*^9}},ExpressionUUID->"be2ad82a-18c6-43de-824a-\
066330ce0dde"],

Cell[TextData[{
 "The repulsive interaction force between ",
 Cell[BoxData[
  FormBox["i", TraditionalForm]],ExpressionUUID->
  "e70f180c-9ca5-47e4-9f75-baed67939104"],
 " and ",
 Cell[BoxData[
  FormBox["j", TraditionalForm]],ExpressionUUID->
  "63b3ac02-f4c1-4643-bf5a-2b2b809036f5"],
 " is"
}], "Text",
 CellChangeTimes->{
  3.7767172377664404`*^9, {3.776717397554256*^9, 
   3.776717472722627*^9}},ExpressionUUID->"f8e71323-1420-43c0-889b-\
61c038512d3d"],

Cell[BoxData[
 FormBox[
  RowBox[{
   SubscriptBox["A", "i"], 
   RowBox[{"exp", "(", 
    FractionBox[
     RowBox[{
      SubscriptBox["r", "ij"], "-", 
      SubscriptBox["d", "ij"]}], 
     SubscriptBox["B", "i"]], ")"}], 
   SubscriptBox[
    OverscriptBox["n", "\[RightVector]"], "ij"]}], 
  TraditionalForm]], "DisplayFormula",
 CellChangeTimes->{
  3.7767172377664404`*^9, {3.776717397554256*^9, 
   3.7767174700431833`*^9}},ExpressionUUID->"2297ce7e-ad0c-49bb-89cc-\
15ebe768734f"],

Cell["Some other simple definitional constraints include", "Text",
 CellChangeTimes->{
  3.7767172377664404`*^9, {3.776717397554256*^9, 
   3.77671748395348*^9}},ExpressionUUID->"27bb1d89-aa33-497d-a3ed-\
775fa0567c66"],

Cell[BoxData[{
 FormBox[
  RowBox[{
   SubscriptBox["d", "ij"], "=", 
   RowBox[{"\[LeftDoubleBracketingBar]", 
    RowBox[{
     SubscriptBox[
      OverscriptBox["r", "\[RightVector]"], "i"], "-", 
     SubscriptBox[
      OverscriptBox["r", "\[RightVector]"], "j"]}], 
    "\[RightDoubleBracketingBar]"}]}], TraditionalForm], "\n", 
 FormBox[
  RowBox[{
   SubscriptBox[
    OverscriptBox["n", "\[RightVector]"], "ij"], "=", 
   FractionBox[
    RowBox[{
     SubscriptBox[
      OverscriptBox["r", "\[RightVector]"], "i"], "-", 
     SubscriptBox[
      OverscriptBox["r", "\[RightVector]"], "j"]}], 
    SubscriptBox["d", "ij"]]}], TraditionalForm], "\n", 
 FormBox[
  RowBox[{
   SubscriptBox["r", "ij"], "=", 
   RowBox[{
    SubscriptBox["r", "i"], "+", 
    SubscriptBox["r", "j"]}]}], TraditionalForm]}], "DisplayFormula",
 CellChangeTimes->{
  3.7767172377664404`*^9, {3.776717397554256*^9, 
   3.7767175006033335`*^9}},ExpressionUUID->"74a13510-27b7-4b2e-b970-\
c1cba9be9a33"],

Cell[TextData[{
 "Pedestrians touch each other whenever their distance ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["d", "ij"], TraditionalForm]],ExpressionUUID->
  "5d6e740b-4197-4f35-af62-6cb84bc5c68f"],
 " is less than their combined radii ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["r", "ij"], TraditionalForm]],ExpressionUUID->
  "2be19958-9086-418b-9cd6-fd22949f3181"],
 ". In this case, two additional forces take effect. Body force counteracts \
body compression, and sliding friction impedes relative tangential motion. \
They are given, respectively, by"
}], "Text",
 CellChangeTimes->{
  3.7767172377664404`*^9, {3.776717397554256*^9, 3.7767175064492064`*^9}, 
   3.8743589843194485`*^9},ExpressionUUID->"f5464920-0990-4933-9e3e-\
3087e58b7bf4"],

Cell[BoxData[{
 FormBox[
  RowBox[{"k", " ", 
   RowBox[{"g", "(", 
    RowBox[{
     SubscriptBox["r", "ij"], "-", 
     SubscriptBox["d", "ij"]}], ")"}], 
   SubscriptBox[
    OverscriptBox["n", "\[RightVector]"], "ij"]}], TraditionalForm], "\n", 
 FormBox[
  RowBox[{"\[Kappa]", " ", 
   RowBox[{"g", "(", 
    RowBox[{
     SubscriptBox["r", "ij"], "-", 
     SubscriptBox["d", "ij"]}], ")"}], 
   SuperscriptBox[
    SubscriptBox["\[CapitalDelta]v", "ji"], "t"], 
   SubscriptBox[
    OverscriptBox["t", "\[RightVector]"], "ij"]}], 
  TraditionalForm]}], "DisplayFormula",
 CellChangeTimes->{
  3.7767172377664404`*^9, {3.776717397554256*^9, 3.776717519142268*^9}, {
   3.874359106970002*^9, 
   3.874359108975803*^9}},ExpressionUUID->"a8b61a64-4296-4b0c-a594-\
b71a36b83542"],

Cell["\<\
The tangential direction and tangntial velocity differences are given, \
respectively, by\
\>", "Text",
 CellChangeTimes->{
  3.7767172377664404`*^9, {3.776717397554256*^9, 3.776717524388327*^9}, 
   3.874358994016967*^9},ExpressionUUID->"826c2e89-5728-4ebf-909b-\
c41834b2f0d8"],

Cell[BoxData[{
 FormBox[
  RowBox[{
   SubscriptBox[
    OverscriptBox["t", "\[RightVector]"], "ij"], "=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"-", 
      SuperscriptBox[
       SubscriptBox["n", "ij"], "2"]}], ",", 
     SuperscriptBox[
      SubscriptBox["n", "ij"], "1"]}], ")"}]}], TraditionalForm], "\n", 
 FormBox[
  RowBox[{
   SuperscriptBox[
    SubscriptBox["\[CapitalDelta]v", "ij"], "t"], "=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      SubscriptBox[
       OverscriptBox["v", "\[RightVector]"], "j"], "-", 
      SubscriptBox[
       OverscriptBox["v", "\[RightVector]"], "i"]}], ")"}], "\[CenterDot]", 
    SubscriptBox[
     OverscriptBox["t", "\[RightVector]"], "ij"]}]}], 
  TraditionalForm]}], "DisplayFormula",
 CellChangeTimes->{
  3.7767172377664404`*^9, {3.776717397554256*^9, 
   3.776717535569138*^9}},ExpressionUUID->"dd0628b3-3d8c-45a8-bffc-\
bdfaaa3acd53"],

Cell[TextData[{
 "Combining all of the forces, we can define the interaction force between \
pedestrians ",
 Cell[BoxData[
  FormBox["i", TraditionalForm]],ExpressionUUID->
  "135a5068-1053-43e2-ab84-a26f5f34ba99"],
 " and ",
 Cell[BoxData[
  FormBox["j", TraditionalForm]],ExpressionUUID->
  "f838fab5-8ffb-46fd-8a54-f8d659c17e5a"],
 " as"
}], "Text",
 CellChangeTimes->{
  3.7767172377664404`*^9, {3.776717397554256*^9, 
   3.776717541801302*^9}},ExpressionUUID->"2b97b23d-bf2b-4737-a826-\
f730d657448b"],

Cell[BoxData[
 FormBox[
  RowBox[{
   SubscriptBox[
    OverscriptBox["f", "\[RightVector]"], "ij"], "=", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        SubscriptBox["A", "i"], 
        RowBox[{"exp", "(", 
         FractionBox[
          RowBox[{
           SubscriptBox["r", "ij"], "-", 
           SubscriptBox["d", "ij"]}], 
          SubscriptBox["B", "i"]], ")"}]}], "+", 
       RowBox[{"k", " ", 
        RowBox[{"g", "(", 
         RowBox[{
          SubscriptBox["r", "ij"], "-", 
          SubscriptBox["d", "ij"]}], ")"}]}]}], ")"}], 
     SubscriptBox[
      OverscriptBox["n", "\[RightVector]"], "ij"]}], "+", 
    RowBox[{"\[Kappa]", " ", 
     RowBox[{"g", "(", 
      RowBox[{
       SubscriptBox["r", "ij"], "-", 
       SubscriptBox["d", "ij"]}], ")"}], 
     SuperscriptBox[
      SubscriptBox["\[CapitalDelta]v", "ji"], "t"], 
     SubscriptBox[
      OverscriptBox["t", "\[RightVector]"], "ij"]}]}]}], 
  TraditionalForm]], "DisplayFormula",
 CellChangeTimes->{
  3.7767172377664404`*^9, {3.776717397554256*^9, 
   3.776717554097148*^9}},ExpressionUUID->"40a6e0fe-eacb-47ec-b7af-\
7ef89d5f21d8"],

Cell[TextData[{
 "and between pedestrian ",
 Cell[BoxData[
  FormBox["i", TraditionalForm]],ExpressionUUID->
  "f7a8b883-c4f9-4f4a-8c0c-085bfb244390"],
 " and a wall it is"
}], "Text",
 CellChangeTimes->{
  3.7767172377664404`*^9, {3.776717397554256*^9, 
   3.7767175595062294`*^9}},ExpressionUUID->"27af105f-0e3e-44b4-876e-\
c0b6aba120cc"],

Cell[BoxData[
 FormBox[
  RowBox[{
   SubscriptBox[
    OverscriptBox["f", "\[RightVector]"], "iW"], "=", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        SubscriptBox["A", "i"], 
        RowBox[{"exp", "(", 
         FractionBox[
          RowBox[{
           SubscriptBox["r", "i"], "-", 
           SubscriptBox["d", "iW"]}], 
          SubscriptBox["B", "i"]], ")"}]}], "+", 
       RowBox[{"k", " ", 
        RowBox[{"g", "(", 
         RowBox[{
          SubscriptBox["r", "i"], "-", 
          SubscriptBox["d", "iW"]}], ")"}]}]}], ")"}], 
     SubscriptBox[
      OverscriptBox["n", "\[RightVector]"], "iW"]}], "-", 
    RowBox[{"\[Kappa]", " ", 
     RowBox[{"g", "(", 
      RowBox[{
       SubscriptBox["r", "i"], "-", 
       SubscriptBox["d", "iW"]}], ")"}], 
     RowBox[{"(", 
      RowBox[{
       SubscriptBox[
        OverscriptBox["v", "\[RightVector]"], "i"], "\[CenterDot]", 
       SubscriptBox[
        OverscriptBox["t", "\[RightVector]"], "iW"]}], ")"}], 
     SubscriptBox[
      OverscriptBox["t", "\[RightVector]"], "iW"]}]}]}], 
  TraditionalForm]], "DisplayFormula",
 CellChangeTimes->{
  3.7767172377664404`*^9, {3.776717397554256*^9, 
   3.776717568888282*^9}},ExpressionUUID->"eec56e71-4a0a-4d6f-b2ed-\
75bfd7154370"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Code", "Section",
 CellChangeTimes->{{3.776600864408964*^9, 
  3.7766008650447807`*^9}},ExpressionUUID->"aeb228d4-d089-4e83-b31d-\
cbd4c77d28f7"],

Cell[CellGroupData[{

Cell["Initialization", "Subsection",
 CellChangeTimes->{{3.776600871130811*^9, 
  3.776600873087188*^9}},ExpressionUUID->"b64501da-8566-4995-b532-\
6f4664e4d563"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", "constants", " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Dynamic", "[", "v0", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "Np", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "bb", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "par1", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "par2", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "W", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "Wg", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "lo", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "Ap", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "Aw", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "door", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "\[Kappa]", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"m", "=", "80.0"}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"pedestrian", " ", "mass"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"v0", "=", "1.0"}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"desired", " ", "pedestrian", " ", "velocity"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Tau]", "=", "0.5"}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "time", " ", "to", " ", "acquire", " ", "desired", " ", "velocity"}], " ",
     "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Ap", "=", 
     RowBox[{"2.0", "*", 
      SuperscriptBox["10", "3"]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Aw", "=", 
     RowBox[{"1.0", "*", 
      SuperscriptBox["10", "3"]}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "repulsive", " ", "interaction", " ", "force", " ", "constant", " ", 
     RowBox[{"(", 
      RowBox[{"people", ",", " ", "wall"}], ")"}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"B", "=", "0.08"}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"repulsive", " ", "interaction", " ", "force", " ", "constant"}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"k", "=", 
     RowBox[{"1.2", "*", 
      SuperscriptBox["10", "5"]}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"body", " ", "force", " ", "constant"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Kappa]", "=", 
     RowBox[{"2.4", "*", 
      SuperscriptBox["10", "5"]}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"sliding", " ", "friction", " ", "force", " ", "constant"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Np", "=", "20"}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"number", " ", "of", " ", "pedestrians"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"radmin", "=", 
     FractionBox["0.5", "2"]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"minimum", " ", "pedestrian", " ", "radius"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"radmax", "=", 
     FractionBox["0.7", "2"]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"maximum", " ", "pedestrian", " ", "radius"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"W", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"10.0", ",", "20.0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"10.0", ",", "5.75"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"10.0", ",", "5.75"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"11.0", ",", "5.75"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"11.0", ",", "5.75"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"11.0", ",", "20.0"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"10.0", ",", 
           RowBox[{"-", "10.0"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"10.0", ",", "4.25"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"10.0", ",", "4.25"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"11.0", ",", "4.25"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"11.0", ",", "4.25"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"11.0", ",", 
           RowBox[{"-", "10.0"}]}], "}"}]}], "}"}]}], "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"list", " ", "of", " ", "wall", " ", "segments"}], ",", " ", 
     RowBox[{
     "expressed", " ", "as", " ", "the", " ", "coordinates", " ", "of", " ", 
      "its", " ", "endpoints"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Wg", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Polygon", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"W", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"W", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"W", "[", 
           RowBox[{"[", 
            RowBox[{"3", ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"W", "[", 
           RowBox[{"[", 
            RowBox[{"3", ",", "2"}], "]"}], "]"}]}], "}"}], "]"}], ",", 
       RowBox[{"Polygon", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"W", "[", 
           RowBox[{"[", 
            RowBox[{"4", ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"W", "[", 
           RowBox[{"[", 
            RowBox[{"5", ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"W", "[", 
           RowBox[{"[", 
            RowBox[{"6", ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"W", "[", 
           RowBox[{"[", 
            RowBox[{"6", ",", "2"}], "]"}], "]"}]}], "}"}], "]"}]}], "}"}]}], 
    ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "graphics", " ", "objects", " ", "for", " ", "the", " ", "walls"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"door", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"10.0", ",", "5.25"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"10.0", ",", "4.75"}], "}"}]}], "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "line", " ", "segment", " ", "that", " ", "people", " ", "will", " ", 
      "try", " ", "to", " ", "move", " ", "towards"}], ",", " ", 
     RowBox[{
     "and", " ", "directly", " ", "right", " ", "after", " ", "that"}]}], " ",
     "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dt", "=", "0.1"}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "time", " ", "increment", " ", "for", " ", "finite", " ", "difference", 
     " ", "solution"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"cutoff", "=", "45.0"}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"simulation", " ", "time", " ", "cutoff", " ", 
     RowBox[{"(", "s", ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"bb", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1.0", ",", "9.0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1.0", ",", "9.0"}], "}"}]}], "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "bounds", " ", "of", " ", "initial", " ", "position", " ", "box"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"par1", "=", "1.5"}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"parameters", " ", "of", " ", "layout"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"par2", "=", "2.0"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"colrad", "=", "0.6"}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "radius", " ", "of", " ", "column", " ", "in", " ", "the", " ", "column", 
     " ", "layout"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Nw", "=", "3"}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "maximum", " ", "number", " ", "of", " ", "walls", " ", "in", " ", "any", 
     " ", "layout"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lo", "=", "0"}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"layout", " ", "index"}], " ", "*)"}], "\n", 
   RowBox[{"(*", " ", "variables", " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "rad", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "radsum", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "r", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "v", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "dvi", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "dij", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "nij", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "tij", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "dvijt", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "e0", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "fij", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "pos", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "pressure", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "niw", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "tiw", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "diw", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "fiw", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "evac", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Dynamic", "[", "tpressure", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", "subroutines", " ", "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"g", "[", "x_", "]"}], ":=", 
     RowBox[{"Max", "[", 
      RowBox[{"0", ",", "x"}], "]"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "function", " ", "to", " ", "cut", " ", "off", " ", "negative", " ", 
     "arguments"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dijcalc", "[", 
      RowBox[{"i_", ",", "j_"}], "]"}], ":=", 
     RowBox[{"EuclideanDistance", "[", 
      RowBox[{
       RowBox[{"r", "[", 
        RowBox[{"[", "i", "]"}], "]"}], ",", 
       RowBox[{"r", "[", 
        RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dniwcalc", "[", 
      RowBox[{"i_", ",", "w_"}], "]"}], ":=", 
     RowBox[{"wallnorm", "[", 
      RowBox[{
       RowBox[{"r", "[", 
        RowBox[{"[", "i", "]"}], "]"}], ",", "w"}], "]"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "calculates", " ", "distances", " ", "and", " ", "normal", " ", "vectors",
      " ", "for", " ", "walls"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"fijcalc", "[", 
      RowBox[{"i_", ",", "j_"}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"i", "\[Equal]", "j"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Ap", " ", 
            RowBox[{"Exp", "[", 
             FractionBox[
              RowBox[{
               RowBox[{"radsum", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "j"}], "]"}], "]"}], "-", 
               RowBox[{"dij", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "j"}], "]"}], "]"}]}], "B"], "]"}]}], "+", 
           RowBox[{"k", " ", 
            RowBox[{"g", "[", 
             RowBox[{
              RowBox[{"radsum", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}], "-", 
              RowBox[{"dij", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}]}], "]"}]}]}], ")"}], 
         RowBox[{"nij", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "j"}], "]"}], "]"}]}], "+", 
        RowBox[{"\[Kappa]", " ", 
         RowBox[{"g", "[", 
          RowBox[{
           RowBox[{"radsum", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "-", 
           RowBox[{"dij", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}]}], "]"}], 
         RowBox[{"dvijt", "[", 
          RowBox[{"[", 
           RowBox[{"j", ",", "i"}], "]"}], "]"}], 
         RowBox[{"tij", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "j"}], "]"}], "]"}]}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"fiwcalc", "[", 
      RowBox[{"i_", ",", "w_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Aw", " ", 
          RowBox[{"Exp", "[", 
           FractionBox[
            RowBox[{
             RowBox[{"rad", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "-", 
             RowBox[{"diw", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "w"}], "]"}], "]"}]}], "B"], "]"}]}], "+", 
         RowBox[{"k", " ", 
          RowBox[{"g", "[", 
           RowBox[{
            RowBox[{"rad", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "-", 
            RowBox[{"diw", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "w"}], "]"}], "]"}]}], "]"}]}]}], ")"}], 
       RowBox[{"niw", "[", 
        RowBox[{"[", 
         RowBox[{"i", ",", "w"}], "]"}], "]"}]}], "-", 
      RowBox[{"\[Kappa]", " ", 
       RowBox[{"g", "[", 
        RowBox[{
         RowBox[{"rad", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "-", 
         RowBox[{"diw", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "w"}], "]"}], "]"}]}], "]"}], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"[", "i", "]"}], "]"}], ".", 
         RowBox[{"tiw", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "w"}], "]"}], "]"}]}], ")"}], 
       RowBox[{"tiw", "[", 
        RowBox[{"[", 
         RowBox[{"i", ",", "w"}], "]"}], "]"}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"nijcalc", "[", 
      RowBox[{"i_", ",", "j_"}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"i", "\[Equal]", "j"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}], ",", 
       FractionBox[
        RowBox[{
         RowBox[{"r", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "-", 
         RowBox[{"r", "[", 
          RowBox[{"[", "j", "]"}], "]"}]}], 
        RowBox[{"dij", "[", 
         RowBox[{"[", 
          RowBox[{"i", ",", "j"}], "]"}], "]"}]]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tijcalc", "[", 
      RowBox[{"i_", ",", "j_"}], "]"}], ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{"nij", "[", 
         RowBox[{"[", 
          RowBox[{"i", ",", "j", ",", "2"}], "]"}], "]"}]}], ",", 
       RowBox[{"nij", "[", 
        RowBox[{"[", 
         RowBox[{"i", ",", "j", ",", "1"}], "]"}], "]"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"tiwcalc", "[", 
      RowBox[{"i_", ",", "w_"}], "]"}], ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{"niw", "[", 
         RowBox[{"[", 
          RowBox[{"i", ",", "w", ",", "2"}], "]"}], "]"}]}], ",", 
       RowBox[{"niw", "[", 
        RowBox[{"[", 
         RowBox[{"i", ",", "w", ",", "1"}], "]"}], "]"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dvijtcalc", "[", 
      RowBox[{"i_", ",", "j_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"[", "i", "]"}], "]"}], "-", 
        RowBox[{"v", "[", 
         RowBox[{"[", "j", "]"}], "]"}]}], ")"}], ".", 
      RowBox[{"tij", "[", 
       RowBox[{"[", 
        RowBox[{"j", ",", "i"}], "]"}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"e0calc", "[", "i_", "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"[", 
          RowBox[{"i", ",", "1"}], "]"}], "]"}], "\[GreaterEqual]", 
        RowBox[{"door", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "past", " ", "the", " ", "door", " ", "just", " ", "go", " ", 
         "right"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"1", ",", "0"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "otherwise", " ", "find", " ", "the", " ", "closest", " ", "point", 
         " ", "on", " ", "the", " ", "door"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Piecewise", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"door", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "-", 
              RowBox[{"r", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"r", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "2"}], "]"}], "]"}], "\[GreaterEqual]", 
              RowBox[{"door", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "2"}], "]"}], "]"}]}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"door", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "-", 
              RowBox[{"r", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"r", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "2"}], "]"}], "]"}], "\[LessEqual]", 
              RowBox[{"door", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], "}"}]}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "0"}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dvicalc", "[", "i_", "]"}], ":=", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        FractionBox[
         RowBox[{
          RowBox[{"v0", " ", 
           RowBox[{"e0", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], "-", 
          RowBox[{"v", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], "\[Tau]"], "+", 
        RowBox[{
         FractionBox["1", "m"], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"j", "\[Equal]", "i"}], ",", "0", ",", 
               RowBox[{"fij", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "j"}], "]"}], "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", "Np"}], "}"}]}], "]"}], "+", 
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{"fiw", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "w"}], "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"w", ",", "1", ",", "Nw"}], "}"}]}], "]"}]}], ")"}]}]}],
        ")"}], "dt"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "finite", " ", "difference", " ", "calculation", " ", "of", " ", Cell[
     TextData[Cell[BoxData[
      FormBox[
       OverscriptBox[
        SubscriptBox["\[CapitalDelta]v", "i"], "\[RightVector]"], 
       TraditionalForm]],ExpressionUUID->
      "123bc67c-8ab5-4d6d-9c79-7ac8a20639ba"]],ExpressionUUID->
      "b81f4a42-37f0-434b-a76f-5abe2eb07b8e"]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"vcalc", "[", "i_", "]"}], ":=", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{"[", "i", "]"}], "]"}], "+", 
      RowBox[{"dvi", "[", 
       RowBox[{"[", "i", "]"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"rcalc", "[", "i_", "]"}], ":=", 
     RowBox[{
      RowBox[{"r", "[", 
       RowBox[{"[", "i", "]"}], "]"}], "+", 
      RowBox[{
       RowBox[{"v", "[", 
        RowBox[{"[", "i", "]"}], "]"}], "dt"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"vcap", "[", "i_", "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Norm", "[", 
         RowBox[{"v", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "]"}], "\[LessEqual]", "v0"}], ",", 
       RowBox[{"v", "[", 
        RowBox[{"[", "i", "]"}], "]"}], ",", 
       FractionBox[
        RowBox[{"v0", " ", 
         RowBox[{"v", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], 
        RowBox[{"Norm", "[", 
         RowBox[{"v", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "]"}]]}], "]"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "caps", " ", "speed", " ", "to", " ", "prevent", " ", "people", " ", 
     "from", " ", "moving", " ", "unrealistically", " ", "quickly"}], " ", 
    "*)"}], "\n", 
   RowBox[{"(*", " ", 
    RowBox[{"update", " ", "process"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"update", "[", 
     RowBox[{"dummy_", ":", "0"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"calculate", " ", "desired", " ", "directions"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"e0", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"e0calc", "[", "i", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "Np"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"calculate", " ", "pairwise", " ", "distances"}], " ", "*)"}],
        "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"dij", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
            RowBox[{
             RowBox[{"dij", "[", 
              RowBox[{"[", 
               RowBox[{"j", ",", "i"}], "]"}], "]"}], "=", 
             RowBox[{"dijcalc", "[", 
              RowBox[{"i", ",", "j"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", 
             RowBox[{"i", "-", "1"}]}], "}"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "Np"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "calculate", " ", "symmetric", " ", "and", " ", "antisymmetric", " ", 
         "pairwise", " ", "values"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"dij", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
             RowBox[{
              RowBox[{"dij", "[", 
               RowBox[{"[", 
                RowBox[{"j", ",", "i"}], "]"}], "]"}], "=", 
              RowBox[{"dijcalc", "[", 
               RowBox[{"i", ",", "j"}], "]"}]}]}], ";", 
            RowBox[{"(*", " ", "distance", " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"nij", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
             RowBox[{"nijcalc", "[", 
              RowBox[{"i", ",", "j"}], "]"}]}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{"pointing", " ", "vector"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"nij", "[", 
              RowBox[{"[", 
               RowBox[{"j", ",", "i"}], "]"}], "]"}], "=", 
             RowBox[{"-", 
              RowBox[{"nij", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"tij", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
             RowBox[{"tijcalc", "[", 
              RowBox[{"i", ",", "j"}], "]"}]}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{"tangential", " ", "vector"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"tij", "[", 
              RowBox[{"[", 
               RowBox[{"j", ",", "i"}], "]"}], "]"}], "=", 
             RowBox[{"-", 
              RowBox[{"tij", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"dvijt", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
             RowBox[{
              RowBox[{"dvijt", "[", 
               RowBox[{"[", 
                RowBox[{"j", ",", "i"}], "]"}], "]"}], "=", 
              RowBox[{"dvijtcalc", "[", 
               RowBox[{"i", ",", "j"}], "]"}]}]}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{"relative", " ", "tangential", " ", "velocity"}], " ", 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"(*", " ", "forces", " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"fij", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
             RowBox[{"fijcalc", "[", 
              RowBox[{"i", ",", "j"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"fij", "[", 
              RowBox[{"[", 
               RowBox[{"j", ",", "i"}], "]"}], "]"}], "=", 
             RowBox[{"-", 
              RowBox[{"fij", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}]}]}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", 
             RowBox[{"i", "-", "1"}]}], "}"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "Np"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"calculate", " ", "wall", " ", "values"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"niw", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "w"}], "]"}], "]"}], ",", 
               RowBox[{"diw", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "w"}], "]"}], "]"}]}], "}"}], "=", 
             RowBox[{"dniwcalc", "[", 
              RowBox[{"i", ",", "w"}], "]"}]}], ";"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"niw", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "w"}], "]"}], "]"}], "=", 
             RowBox[{
              RowBox[{"dniwcalc", "[", 
               RowBox[{"i", ",", "w"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"diw", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "w"}], "]"}], "]"}], "=", 
             RowBox[{
              RowBox[{"dniwcalc", "[", 
               RowBox[{"i", ",", "w"}], "]"}], "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"tiw", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "w"}], "]"}], "]"}], "=", 
             RowBox[{"tiwcalc", "[", 
              RowBox[{"i", ",", "w"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"fiw", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "w"}], "]"}], "]"}], "=", 
             RowBox[{"fiwcalc", "[", 
              RowBox[{"i", ",", "w"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"w", ",", "1", ",", "Nw"}], "}"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "Np"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "calculate", " ", "changes", " ", "in", " ", "velocity", " ", "and", 
         " ", "position"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"dvi", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "=", 
           RowBox[{"dvicalc", "[", "i", "]"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{"change", " ", "in", " ", "velocity"}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"v", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "=", 
           RowBox[{"vcalc", "[", "i", "]"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{"velocity", " ", "update"}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"v", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "=", 
           RowBox[{"vcap", "[", "i", "]"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{"cap", " ", "speed", " ", 
            RowBox[{"(", 
             RowBox[{"just", " ", "in", " ", "case"}], ")"}]}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "=", 
           RowBox[{"rcalc", "[", "i", "]"}]}]}], ",", 
         RowBox[{"(*", " ", 
          RowBox[{"position", " ", "update"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "Np"}], "}"}]}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"generate", " ", "layout", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"wall", " ", "lines"}], ",", " ", 
       RowBox[{"wall", " ", "graphics"}], ",", " ", 
       RowBox[{"bounding", " ", "box"}], ",", " ", "door"}], "}"}]}], " ", 
    "*)"}], "\n", 
   RowBox[{
    RowBox[{"wallgen", "[", 
     RowBox[{"layout_", ",", "p1_", ",", "p2_"}], "]"}], ":=", 
    RowBox[{"Switch", "[", 
     RowBox[{"layout", ",", "\[IndentingNewLine]", "0", ",", 
      RowBox[{"(*", " ", 
       RowBox[{"single", " ", "door"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"(*", " ", "W", " ", "*)"}], 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"10.0", ",", "20.0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"10.0", ",", 
              RowBox[{"5.0", "+", 
               FractionBox["p1", "2"]}]}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"10.0", ",", 
              RowBox[{"5.0", "+", 
               FractionBox["p1", "2"]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"11.0", ",", 
              RowBox[{"5.0", "+", 
               FractionBox["p1", "2"]}]}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"11.0", ",", 
              RowBox[{"5.0", "+", 
               FractionBox["p1", "2"]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"11.0", ",", "20.0"}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"10.0", ",", 
              RowBox[{"-", "10.0"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"10.0", ",", 
              RowBox[{"5.0", "-", 
               FractionBox["p1", "2"]}]}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"10.0", ",", 
              RowBox[{"5.0", "-", 
               FractionBox["p1", "2"]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"11.0", ",", 
              RowBox[{"5.0", "-", 
               FractionBox["p1", "2"]}]}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"11.0", ",", 
              RowBox[{"5.0", "-", 
               FractionBox["p1", "2"]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"11.0", ",", 
              RowBox[{"-", "10.0"}]}], "}"}]}], "}"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "Wg", " ", "*)"}], 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Polygon", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"10.0", ",", "20.0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"10.0", ",", 
               RowBox[{"5.0", "+", 
                FractionBox["p1", "2"]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"11.0", ",", 
               RowBox[{"5.0", "+", 
                FractionBox["p1", "2"]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"11.0", ",", "20.0"}], "}"}]}], "}"}], "]"}], ",", 
          RowBox[{"Polygon", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"10.0", ",", 
               RowBox[{"-", "10.0"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"10.0", ",", 
               RowBox[{"5.0", "-", 
                FractionBox["p1", "2"]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"11.0", ",", 
               RowBox[{"5.0", "-", 
                FractionBox["p1", "2"]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"11.0", ",", 
               RowBox[{"-", "10.0"}]}], "}"}]}], "}"}], "]"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "bb", " ", "*)"}], 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1.0", ",", "9.0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1.0", ",", "9.0"}], "}"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "door", " ", "*)"}], 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"10.0", ",", 
            RowBox[{"5.0", "+", 
             FractionBox["p1", "2"], "-", "0.5"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"10.0", ",", 
            RowBox[{"5.0", "-", 
             FractionBox["p1", "2"], "+", "0.5"}]}], "}"}]}], "}"}]}], "}"}], 
      ",", "\[IndentingNewLine]", "1", ",", 
      RowBox[{"(*", " ", 
       RowBox[{"column", " ", "and", " ", "door"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"(*", " ", "W", " ", "*)"}], 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"10.0", ",", "20.0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"10.0", ",", 
              RowBox[{"5.0", "+", 
               FractionBox["p1", "2"]}]}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"10.0", ",", 
              RowBox[{"5.0", "+", 
               FractionBox["p1", "2"]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"11.0", ",", 
              RowBox[{"5.0", "+", 
               FractionBox["p1", "2"]}]}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"11.0", ",", 
              RowBox[{"5.0", "+", 
               FractionBox["p1", "2"]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"11.0", ",", "20.0"}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"10.0", ",", 
              RowBox[{"-", "10.0"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"10.0", ",", 
              RowBox[{"5.0", "-", 
               FractionBox["p1", "2"]}]}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"10.0", ",", 
              RowBox[{"5.0", "-", 
               FractionBox["p1", "2"]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"11.0", ",", 
              RowBox[{"5.0", "-", 
               FractionBox["p1", "2"]}]}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"11.0", ",", 
              RowBox[{"5.0", "-", 
               FractionBox["p1", "2"]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"11.0", ",", 
              RowBox[{"-", "10.0"}]}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"10.0", "-", "p2"}], ",", "5.5"}], "}"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "Wg", " ", "*)"}], 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Polygon", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"10.0", ",", "20.0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"10.0", ",", 
               RowBox[{"5.0", "+", 
                FractionBox["p1", "2"]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"11.0", ",", 
               RowBox[{"5.0", "+", 
                FractionBox["p1", "2"]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"11.0", ",", "20.0"}], "}"}]}], "}"}], "]"}], ",", 
          RowBox[{"Polygon", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"10.0", ",", 
               RowBox[{"-", "10.0"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"10.0", ",", 
               RowBox[{"5.0", "-", 
                FractionBox["p1", "2"]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"11.0", ",", 
               RowBox[{"5.0", "-", 
                FractionBox["p1", "2"]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"11.0", ",", 
               RowBox[{"-", "10.0"}]}], "}"}]}], "}"}], "]"}], ",", 
          RowBox[{"Disk", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"10.0", "-", "p2"}], ",", "5.5"}], "}"}], ",", 
            "colrad"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "bb", " ", "*)"}], 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1.0", ",", "9.0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1.0", ",", "9.0"}], "}"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "door", " ", "*)"}], 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"10.0", ",", 
            RowBox[{"5.0", "+", 
             FractionBox["p1", "2"], "-", "0.5"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"10.0", ",", 
            RowBox[{"5.0", "-", 
             FractionBox["p1", "2"], "+", "0.5"}]}], "}"}]}], "}"}]}], "}"}], 
      ",", "\[IndentingNewLine]", "2", ",", 
      RowBox[{"(*", " ", 
       RowBox[{"hallway", " ", "with", " ", "bulge"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"(*", " ", "W", " ", "*)"}], 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0.0", ",", "6.5"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"7.0", ",", "6.5"}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"7.0", ",", "6.5"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"10.0", ",", 
              RowBox[{"6.5", "+", 
               RowBox[{"3.0", 
                RowBox[{"Tan", "[", "p1", "]"}]}]}]}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"10.0", ",", 
              RowBox[{"6.5", "+", 
               RowBox[{"3.0", 
                RowBox[{"Tan", "[", "p1", "]"}]}]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"13.0", ",", "6.5"}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"13.0", ",", "6.5"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"20.0", ",", "6.5"}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0.0", ",", "3.5"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"7.0", ",", "3.5"}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"7.0", ",", "3.5"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"10.0", ",", 
              RowBox[{"3.5", "-", 
               RowBox[{"3.0", 
                RowBox[{"Tan", "[", "p1", "]"}]}]}]}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"10.0", ",", 
              RowBox[{"3.5", "-", 
               RowBox[{"3.0", 
                RowBox[{"Tan", "[", "p1", "]"}]}]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"13.0", ",", "3.5"}], "}"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"13.0", ",", "3.5"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"20.0", ",", "3.5"}], "}"}]}], "}"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "Wg", " ", "*)"}], 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Polygon", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0.0", ",", "6.5"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"7.0", ",", "6.5"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"10.0", ",", 
               RowBox[{"6.5", "+", 
                RowBox[{"3.0", 
                 RowBox[{"Tan", "[", "p1", "]"}]}]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"13.0", ",", "6.5"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"20.0", ",", "6.5"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"20.0", ",", "7.0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"13.0", "+", 
                RowBox[{"0.5", 
                 RowBox[{"Tan", "[", 
                  RowBox[{"0.5", "p1"}], "]"}]}]}], ",", "7.0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"10.0", ",", 
               RowBox[{"6.5", "+", 
                RowBox[{"0.5", 
                 RowBox[{"Sec", "[", "p1", "]"}]}], "+", 
                RowBox[{"3.0", 
                 RowBox[{"Tan", "[", "p1", "]"}]}]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"7.0", "-", 
                RowBox[{"0.5", 
                 RowBox[{"Tan", "[", 
                  RowBox[{"0.5", "p1"}], "]"}]}]}], ",", "7.0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"0.0", ",", "7.0"}], "}"}]}], "}"}], "]"}], ",", 
          RowBox[{"Polygon", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0.0", ",", "3.5"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"7.0", ",", "3.5"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"10.0", ",", 
               RowBox[{"3.5", "-", 
                RowBox[{"3.0", 
                 RowBox[{"Tan", "[", "p1", "]"}]}]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"13.0", ",", "3.5"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"20.0", ",", "3.5"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"20.0", ",", "3.0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"13.0", "+", 
                RowBox[{"0.5", 
                 RowBox[{"Tan", "[", 
                  RowBox[{"0.5", "p1"}], "]"}]}]}], ",", "3.0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"10.0", ",", 
               RowBox[{"3.5", "-", 
                RowBox[{"0.5", 
                 RowBox[{"Sec", "[", "p1", "]"}]}], "-", 
                RowBox[{"3.0", 
                 RowBox[{"Tan", "[", "p1", "]"}]}]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"7.0", "-", 
                RowBox[{"0.5", 
                 RowBox[{"Tan", "[", 
                  RowBox[{"0.5", "p1"}], "]"}]}]}], ",", "3.0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"0.0", ",", "3.0"}], "}"}]}], "}"}], "]"}]}], "}"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "bb", " ", "*)"}], 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0.0", ",", "8.0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"4.0", ",", "6.0"}], "}"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "door", " ", "*)"}], 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"15.0", ",", "6.0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"15.0", ",", "4.0"}], "}"}]}], "}"}]}], "}"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "generates", " ", "a", " ", "color", " ", "that", " ", "varies", " ", 
     "linearly", " ", "from", " ", "green", " ", 
     RowBox[{"(", 
      RowBox[{"at", " ", "input", " ", "0"}], ")"}], " ", "to", " ", "red", 
     " ", 
     RowBox[{"(", 
      RowBox[{
      "at", " ", "input", " ", "equal", " ", "to", " ", "max", " ", 
       "pressure"}], ")"}]}], " ", "*)"}], "\n", 
   RowBox[{
    RowBox[{"colmap", "[", 
     RowBox[{"x_", ",", 
      RowBox[{"max_", ":", "1800"}]}], "]"}], ":=", 
    RowBox[{"RGBColor", "[", 
     RowBox[{
      RowBox[{"Min", "[", 
       RowBox[{
        FractionBox["x", "max"], ",", "1"}], "]"}], ",", 
      RowBox[{"0.8", 
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"Min", "[", 
          RowBox[{
           FractionBox["x", "max"], ",", "1"}], "]"}]}], ")"}]}], ",", "0"}], 
     "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "generates", " ", "a", " ", "normalized", " ", "vector", " ", "and", " ", 
     "distance", " ", "for", " ", "a", " ", "given", " ", "layout", " ", 
     "pointing", " ", "from", " ", "a", " ", "specified", " ", "wall", " ", 
     "to", " ", "a", " ", "specified", " ", "coordinate"}], " ", "*)"}], "\n", 
   RowBox[{
    RowBox[{"wallnorm", "[", 
     RowBox[{"coord_", ",", "wall_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"pt", ",", 
        RowBox[{"far", "=", "1000"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Switch", "[", 
        RowBox[{"lo", ",", "\[IndentingNewLine]", "0", ",", 
         RowBox[{"(*", " ", 
          RowBox[{"single", " ", "door"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"Switch", "[", 
          RowBox[{"wall", ",", "\[IndentingNewLine]", "1", ",", 
           RowBox[{"(*", " ", 
            RowBox[{"top", " ", "wall"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"coord", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "<", 
              RowBox[{"W", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"left", " ", "of", " ", "wall"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"coord", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "\[GreaterEqual]", 
                RowBox[{"W", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "2", ",", "2"}], "]"}], "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"next", " ", "to", " ", "long", " ", "side"}], " ", 
                "*)"}], "\[IndentingNewLine]", 
               RowBox[{"pt", "=", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"W", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}], ",", 
                  RowBox[{"coord", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"near", " ", "corner"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"pt", "=", 
                 RowBox[{"W", "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ";"}]}], 
              "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"right", " ", "of", " ", "wall"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"coord", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ">", 
                 RowBox[{"W", "[", 
                  RowBox[{"[", 
                   RowBox[{"2", ",", "2", ",", "1"}], "]"}], "]"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"too", " ", "far", " ", "to", " ", "right"}], " ", 
                 "*)"}], "\[IndentingNewLine]", 
                RowBox[{"pt", "=", 
                 RowBox[{"{", 
                  RowBox[{"far", ",", "5.0"}], "}"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"inside", " ", "doorway"}], " ", "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"pt", "=", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"W", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2", ",", "2"}], "]"}], "]"}]}], 
                   "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", "2", 
           ",", 
           RowBox[{"(*", " ", 
            RowBox[{"bottom", " ", "wall"}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"coord", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "<", 
              RowBox[{"W", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"left", " ", "of", " ", "wall"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"coord", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "\[LessEqual]", 
                RowBox[{"W", "[", 
                 RowBox[{"[", 
                  RowBox[{"4", ",", "2", ",", "2"}], "]"}], "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"next", " ", "to", " ", "long", " ", "side"}], " ", 
                "*)"}], "\[IndentingNewLine]", 
               RowBox[{"pt", "=", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"W", "[", 
                   RowBox[{"[", 
                    RowBox[{"4", ",", "1", ",", "1"}], "]"}], "]"}], ",", 
                  RowBox[{"coord", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"near", " ", "corner"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"pt", "=", 
                 RowBox[{"W", "[", 
                  RowBox[{"[", 
                   RowBox[{"4", ",", "2"}], "]"}], "]"}]}], ";"}]}], 
              "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"right", " ", "of", " ", "wall"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"coord", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ">", 
                 RowBox[{"W", "[", 
                  RowBox[{"[", 
                   RowBox[{"5", ",", "2", ",", "1"}], "]"}], "]"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"too", " ", "far", " ", "to", " ", "right"}], " ", 
                 "*)"}], "\[IndentingNewLine]", 
                RowBox[{"pt", "=", 
                 RowBox[{"{", 
                  RowBox[{"far", ",", "5.0"}], "}"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"inside", " ", "doorway"}], " ", "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"pt", "=", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"W", "[", 
                    RowBox[{"[", 
                    RowBox[{"4", ",", "2", ",", "2"}], "]"}], "]"}]}], 
                   "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", "3", 
           ",", 
           RowBox[{"(*", " ", "nothing", " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"pt", "=", 
             RowBox[{"{", 
              RowBox[{"far", ",", "5.0"}], "}"}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", "1", ",", 
         RowBox[{"(*", " ", 
          RowBox[{"column", " ", "and", " ", "door"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"Switch", "[", 
          RowBox[{"wall", ",", "\[IndentingNewLine]", "1", ",", 
           RowBox[{"(*", " ", 
            RowBox[{"top", " ", "wall"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"coord", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "<", 
              RowBox[{"W", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"left", " ", "of", " ", "wall"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"coord", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "\[GreaterEqual]", 
                RowBox[{"W", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "2", ",", "2"}], "]"}], "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"next", " ", "to", " ", "long", " ", "side"}], " ", 
                "*)"}], "\[IndentingNewLine]", 
               RowBox[{"pt", "=", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"W", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}], ",", 
                  RowBox[{"coord", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"near", " ", "corner"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"pt", "=", 
                 RowBox[{"W", "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ";"}]}], 
              "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"right", " ", "of", " ", "wall"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"coord", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ">", 
                 RowBox[{"W", "[", 
                  RowBox[{"[", 
                   RowBox[{"2", ",", "2", ",", "1"}], "]"}], "]"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"too", " ", "far", " ", "to", " ", "right"}], " ", 
                 "*)"}], "\[IndentingNewLine]", 
                RowBox[{"pt", "=", 
                 RowBox[{"{", 
                  RowBox[{"far", ",", "5.0"}], "}"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"inside", " ", "doorway"}], " ", "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"pt", "=", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"W", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2", ",", "2"}], "]"}], "]"}]}], 
                   "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", "2", 
           ",", 
           RowBox[{"(*", " ", 
            RowBox[{"bottom", " ", "wall"}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"coord", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "<", 
              RowBox[{"W", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"left", " ", "of", " ", "wall"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"coord", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "\[LessEqual]", 
                RowBox[{"W", "[", 
                 RowBox[{"[", 
                  RowBox[{"4", ",", "2", ",", "2"}], "]"}], "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"next", " ", "to", " ", "long", " ", "side"}], " ", 
                "*)"}], "\[IndentingNewLine]", 
               RowBox[{"pt", "=", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"W", "[", 
                   RowBox[{"[", 
                    RowBox[{"4", ",", "1", ",", "1"}], "]"}], "]"}], ",", 
                  RowBox[{"coord", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"near", " ", "corner"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"pt", "=", 
                 RowBox[{"W", "[", 
                  RowBox[{"[", 
                   RowBox[{"4", ",", "2"}], "]"}], "]"}]}], ";"}]}], 
              "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"right", " ", "of", " ", "wall"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"coord", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ">", 
                 RowBox[{"W", "[", 
                  RowBox[{"[", 
                   RowBox[{"5", ",", "2", ",", "1"}], "]"}], "]"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"too", " ", "far", " ", "to", " ", "right"}], " ", 
                 "*)"}], "\[IndentingNewLine]", 
                RowBox[{"pt", "=", 
                 RowBox[{"{", 
                  RowBox[{"far", ",", "5.0"}], "}"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"inside", " ", "doorway"}], " ", "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"pt", "=", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"W", "[", 
                    RowBox[{"[", 
                    RowBox[{"4", ",", "2", ",", "2"}], "]"}], "]"}]}], 
                   "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", "3", 
           ",", 
           RowBox[{"(*", " ", "column", " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"coord", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ">", 
               RowBox[{"W", "[", 
                RowBox[{"[", 
                 RowBox[{"5", ",", "2", ",", "1"}], "]"}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"too", " ", "far", " ", "to", " ", "right"}], " ", 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{"pt", "=", 
               RowBox[{"{", 
                RowBox[{"far", ",", "5.0"}], "}"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"closest", " ", "point", " ", "on", " ", "column"}], 
               " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"pt", "=", 
                RowBox[{
                 RowBox[{"W", "[", 
                  RowBox[{"[", "7", "]"}], "]"}], "+", 
                 RowBox[{"colrad", 
                  RowBox[{"(", 
                   FractionBox[
                    RowBox[{"coord", "-", 
                    RowBox[{"W", "[", 
                    RowBox[{"[", "7", "]"}], "]"}]}], 
                    RowBox[{"Norm", "[", 
                    RowBox[{"coord", "-", 
                    RowBox[{"W", "[", 
                    RowBox[{"[", "7", "]"}], "]"}]}], "]"}]], ")"}]}]}]}], 
               ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", "2", ",", 
         RowBox[{"(*", " ", 
          RowBox[{"hallway", " ", "with", " ", "bulge"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Switch", "[", 
           RowBox[{"wall", ",", "\[IndentingNewLine]", "1", ",", 
            RowBox[{"(*", " ", 
             RowBox[{"top", " ", "wall"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"par1", "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"straight", " ", "hallway"}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"pt", "=", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"coord", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ",", "6.5"}], "}"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"angled", " ", "hallway"}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "\[LessEqual]", "7.0"}], "||", 
                  RowBox[{
                   RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "\[GreaterEqual]", 
                   "13.0"}]}], ",", "\[IndentingNewLine]", 
                 RowBox[{"(*", " ", 
                  RowBox[{"straight", " ", "section"}], " ", "*)"}], 
                 "\[IndentingNewLine]", 
                 RowBox[{"pt", "=", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "6.5"}], "}"}]}], 
                 ",", "\[IndentingNewLine]", 
                 RowBox[{"(*", " ", "middle", " ", "*)"}], 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "<", "10.0"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", " ", 
                    RowBox[{"left", " ", "half"}], " ", "*)"}], 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ">", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Cot", "[", "par1", "]"}]}], 
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "+", "6.5", "+", 
                    RowBox[{"7", 
                    RowBox[{"Cot", "[", "par1", "]"}]}]}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", " ", 
                    RowBox[{"left", " ", "angled", " ", "wall"}], " ", "*)"}],
                     "\[IndentingNewLine]", 
                    RowBox[{"pt", "=", 
                    RowBox[{"{", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"7", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "-", "6.5"}], ")"}], 
                    RowBox[{"Cot", "[", "par1", "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], 
                    SuperscriptBox[
                    RowBox[{"Cot", "[", "par1", "]"}], "2"]}]}], 
                    RowBox[{"1", "+", 
                    SuperscriptBox[
                    RowBox[{"Cot", "[", "par1", "]"}], "2"]}]], ",", 
                    FractionBox[
                    RowBox[{"6.5", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", "7"}], ")"}], 
                    RowBox[{"Tan", "[", "par1", "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], 
                    SuperscriptBox[
                    RowBox[{"Tan", "[", "par1", "]"}], "2"]}]}], 
                    RowBox[{"1", "+", 
                    SuperscriptBox[
                    RowBox[{"Tan", "[", "par1", "]"}], "2"]}]]}], "}"}]}], 
                    ",", "\[IndentingNewLine]", 
                    RowBox[{"(*", " ", "corner", " ", "*)"}], 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"pt", "=", 
                    RowBox[{"{", 
                    RowBox[{"7.0", ",", "6.5"}], "}"}]}], ";"}]}], 
                    "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"(*", " ", 
                    RowBox[{"right", " ", "half"}], " ", "*)"}], 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ">", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Cot", "[", "par1", "]"}], 
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "+", "6.5", "-", 
                    RowBox[{"13", 
                    RowBox[{"Cot", "[", "par1", "]"}]}]}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", " ", 
                    RowBox[{"right", " ", "angled", " ", "wall"}], " ", 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"pt", "=", 
                    RowBox[{"{", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"13", "\[VeryThinSpace]", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"6.5", "-", 
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ")"}], " ", 
                    RowBox[{"Cot", "[", "par1", "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Cot", "[", "par1", "]"}], "2"]}]}], 
                    RowBox[{"1", "+", " ", 
                    SuperscriptBox[
                    RowBox[{"Cot", "[", "par1", "]"}], "2"]}]], ",", 
                    FractionBox[
                    RowBox[{"6.5", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"13", "-", 
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ")"}], " ", 
                    RowBox[{"Tan", "[", "par1", "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Tan", "[", "par1", "]"}], "2"]}]}], 
                    RowBox[{"1", "+", 
                    SuperscriptBox[
                    RowBox[{"Tan", "[", "par1", "]"}], "2"]}]]}], "}"}]}], 
                    ",", "\[IndentingNewLine]", 
                    RowBox[{"(*", " ", "corner", " ", "*)"}], 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"pt", "=", 
                    RowBox[{"{", 
                    RowBox[{"13.0", ",", "6.5"}], "}"}]}], ";"}]}], 
                    "\[IndentingNewLine]", "]"}], ";"}]}], 
                   "\[IndentingNewLine]", "]"}], ";"}]}], 
                "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
             "]"}], ",", "\[IndentingNewLine]", "2", ",", 
            RowBox[{"(*", " ", 
             RowBox[{"bottom", " ", "wall"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"par1", "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"straight", " ", "hallway"}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"pt", "=", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"coord", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ",", "3.5"}], "}"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"angled", " ", "hallway"}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "\[LessEqual]", "7.0"}], "||", 
                  RowBox[{
                   RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "\[GreaterEqual]", 
                   "13.0"}]}], ",", "\[IndentingNewLine]", 
                 RowBox[{"(*", " ", 
                  RowBox[{"straight", " ", "section"}], " ", "*)"}], 
                 "\[IndentingNewLine]", 
                 RowBox[{"pt", "=", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "3.5"}], "}"}]}], 
                 ",", "\[IndentingNewLine]", 
                 RowBox[{"(*", " ", "middle", " ", "*)"}], 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "<", "10.0"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", " ", 
                    RowBox[{"left", " ", "half"}], " ", "*)"}], 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "<", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Cot", "[", "par1", "]"}], 
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "+", "3.5", "-", 
                    RowBox[{"7", 
                    RowBox[{"Cot", "[", "par1", "]"}]}]}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", " ", 
                    RowBox[{"left", " ", "angled", " ", "wall"}], " ", "*)"}],
                     "\[IndentingNewLine]", 
                    RowBox[{"pt", "=", 
                    RowBox[{"{", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"7", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"3.5", "-", 
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ")"}], 
                    RowBox[{"Cot", "[", "par1", "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], 
                    SuperscriptBox[
                    RowBox[{"Cot", "[", "par1", "]"}], "2"]}]}], 
                    RowBox[{"1", "+", 
                    SuperscriptBox[
                    RowBox[{"Cot", "[", "par1", "]"}], "2"]}]], ",", 
                    FractionBox[
                    RowBox[{"3.5", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"7", "-", 
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ")"}], 
                    RowBox[{"Tan", "[", "par1", "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], 
                    SuperscriptBox[
                    RowBox[{"Tan", "[", "par1", "]"}], "2"]}]}], 
                    RowBox[{"1", "+", 
                    SuperscriptBox[
                    RowBox[{"Tan", "[", "par1", "]"}], "2"]}]]}], "}"}]}], 
                    ",", "\[IndentingNewLine]", 
                    RowBox[{"(*", " ", "corner", " ", "*)"}], 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"pt", "=", 
                    RowBox[{"{", 
                    RowBox[{"7.0", ",", "3.5"}], "}"}]}], ";"}]}], 
                    "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"(*", " ", 
                    RowBox[{"right", " ", "half"}], " ", "*)"}], 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "<", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Cot", "[", "par1", "]"}]}], 
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "+", "3.5", "+", 
                    RowBox[{"13", 
                    RowBox[{"Cot", "[", "par1", "]"}]}]}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", " ", 
                    RowBox[{"right", " ", "angled", " ", "wall"}], " ", 
                    "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"pt", "=", 
                    RowBox[{"{", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"13", "\[VeryThinSpace]", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "-", "3.5"}], ")"}], " ", 
                    RowBox[{"Cot", "[", "par1", "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Cot", "[", "par1", "]"}], "2"]}]}], 
                    RowBox[{"1", "+", " ", 
                    SuperscriptBox[
                    RowBox[{"Cot", "[", "par1", "]"}], "2"]}]], ",", 
                    FractionBox[
                    RowBox[{"3.5", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", "13"}], ")"}], " ", 
                    RowBox[{"Tan", "[", "par1", "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"coord", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], " ", 
                    SuperscriptBox[
                    RowBox[{"Tan", "[", "par1", "]"}], "2"]}]}], 
                    RowBox[{"1", "+", 
                    SuperscriptBox[
                    RowBox[{"Tan", "[", "par1", "]"}], "2"]}]]}], "}"}]}], 
                    ",", "\[IndentingNewLine]", 
                    RowBox[{"(*", " ", "corner", " ", "*)"}], 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"pt", "=", 
                    RowBox[{"{", 
                    RowBox[{"13.0", ",", "3.5"}], "}"}]}], ";"}]}], 
                    "\[IndentingNewLine]", "]"}], ";"}]}], 
                   "\[IndentingNewLine]", "]"}], ";"}]}], 
                "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
             "]"}], ",", "\[IndentingNewLine]", "3", ",", 
            RowBox[{"(*", " ", "nothing", " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"pt", "=", 
              RowBox[{"{", 
               RowBox[{"far", ",", "5.0"}], "}"}]}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"lo", "\[Equal]", "1"}], "&&", 
          RowBox[{"wall", "\[Equal]", "3"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           FractionBox[
            RowBox[{"coord", "-", "pt"}], 
            RowBox[{"Norm", "[", 
             RowBox[{"coord", "-", "pt"}], "]"}]], ",", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"EuclideanDistance", "[", 
               RowBox[{"coord", ",", 
                RowBox[{"W", "[", 
                 RowBox[{"[", "7", "]"}], "]"}]}], "]"}], "\[LessEqual]", 
              "colrad"}], ",", "0", ",", 
             RowBox[{"Norm", "[", 
              RowBox[{"coord", "-", "pt"}], "]"}]}], "]"}]}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           FractionBox[
            RowBox[{"coord", "-", "pt"}], 
            RowBox[{"Norm", "[", 
             RowBox[{"coord", "-", "pt"}], "]"}]], ",", 
           RowBox[{"Norm", "[", 
            RowBox[{"coord", "-", "pt"}], "]"}]}], "}"}]}], 
        "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\n", 
   RowBox[{"(*", 
    RowBox[{"Manipulate", "[", 
     RowBox[{
      RowBox[{"Show", "[", 
       RowBox[{
        RowBox[{"Graphics", "[", "Wg", "]"}], ",", 
        RowBox[{"Graphics", "[", 
         RowBox[{"{", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"wallnorm", "[", 
             RowBox[{"pt", ",", "w"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"15", ",", "9"}], "}"}]}], "]"}], "}"}], "]"}], ",", 
        RowBox[{"Graphics", "[", 
         RowBox[{"{", 
          RowBox[{"Red", ",", 
           RowBox[{"Arrow", "[", 
            RowBox[{"{", 
             RowBox[{"pt", ",", 
              RowBox[{"pt", "+", 
               RowBox[{"2", 
                RowBox[{
                 RowBox[{"wallnorm", "[", 
                  RowBox[{"pt", ",", "w"}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}]}]}], "}"}], "]"}]}], "}"}], 
         "]"}], ",", 
        RowBox[{"PlotRange", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "20"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "10"}], "}"}]}], "}"}]}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pt", ",", 
          RowBox[{"{", 
           RowBox[{"4.0", ",", "6.0"}], "}"}]}], "}"}], ",", "Locator"}], 
       "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"w", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "}"}]}], "]"}], "*)"}], 
   "\n", 
   RowBox[{"(*", " ", "restart", " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"restart", "[", 
     RowBox[{
      RowBox[{"layout_", ":", "0"}], ",", 
      RowBox[{"np_", ":", "Np"}], ",", 
      RowBox[{"p1_", ":", "par1"}], ",", 
      RowBox[{"p2_", ":", "par2"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"W", ",", "Wg", ",", "bb", ",", "door"}], "}"}], "=", 
        RowBox[{"wallgen", "[", 
         RowBox[{"layout", ",", "p1", ",", "p2"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Np", "=", "np"}], ";", "\[IndentingNewLine]", 
       RowBox[{"par1", "=", "p1"}], ";", "\[IndentingNewLine]", 
       RowBox[{"par2", "=", "p2"}], ";", "\[IndentingNewLine]", 
       RowBox[{"rad", "=", 
        RowBox[{"RandomReal", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"radmin", ",", "radmax"}], "}"}], ",", "np"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"radsum", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{"np", ",", "np"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"radsum", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
            RowBox[{
             RowBox[{"radsum", "[", 
              RowBox[{"[", 
               RowBox[{"j", ",", "i"}], "]"}], "]"}], "=", 
             RowBox[{
              RowBox[{"rad", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "+", 
              RowBox[{"rad", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}]}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", "i"}], "}"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "np"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"r", "=", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"RandomReal", "[", 
            RowBox[{
             RowBox[{"bb", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", "Np"}], "]"}], ",", 
           RowBox[{"RandomReal", "[", 
            RowBox[{
             RowBox[{"bb", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", "Np"}], "]"}]}], "}"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"layout", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "check", " ", "for", " ", "collisions", " ", "with", " ", 
           "column"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"While", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"EuclideanDistance", "[", 
                RowBox[{
                 RowBox[{"r", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ",", 
                 RowBox[{"W", "[", 
                  RowBox[{"[", 
                   RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}], "<", "colrad"}],
               ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"r", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "=", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"RandomReal", "[", 
                   RowBox[{"bb", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
                  RowBox[{"RandomReal", "[", 
                   RowBox[{"bb", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}]}], ";"}]}],
              "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", "np"}], "}"}]}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"v", "=", 
        RowBox[{"dvi", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"np", ",", "2"}], "}"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dij", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{"np", ",", "np"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nij", "=", 
        RowBox[{"tij", "=", 
         RowBox[{"dvijt", "=", 
          RowBox[{"e0", "=", 
           RowBox[{"fij", "=", 
            RowBox[{"ConstantArray", "[", 
             RowBox[{"0", ",", 
              RowBox[{"{", 
               RowBox[{"np", ",", "np", ",", "2"}], "}"}]}], "]"}]}]}]}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"niw", "=", 
        RowBox[{"tiw", "=", 
         RowBox[{"fiw", "=", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0", ",", 
            RowBox[{"{", 
             RowBox[{"Np", ",", "Nw", ",", "2"}], "}"}]}], "]"}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"diw", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{"Np", ",", "Nw"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pressure", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"Floor", "[", 
              FractionBox["cutoff", "dt"], "]"}], "+", "1"}], ",", "Np"}], 
           "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"Floor", "[", 
              FractionBox["cutoff", "dt"], "]"}], "+", "1"}], ",", "Np", ",", 
            "2"}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pos", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "=", "r"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"evac", "=", 
        RowBox[{"tpressure", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{
            RowBox[{"Floor", "[", 
             FractionBox["cutoff", "dt"], "]"}], "+", "1"}]}], "]"}]}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"generate", "[", "]"}], ";"}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "generate", " ", "all", " ", "positions", " ", "for", " ", "entire", " ", 
     "time", " ", "horizon"}], " ", "*)"}], "\n", 
   RowBox[{
    RowBox[{"generate", "[", 
     RowBox[{"dummy_", ":", "0"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"step", "=", "1"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"step", "++"}], ";", "\[IndentingNewLine]", 
          RowBox[{"update", "[", "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"pos", "[", 
            RowBox[{"[", "step", "]"}], "]"}], "=", "r"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"pressure", "[", 
            RowBox[{"[", 
             RowBox[{"step", "-", "1"}], "]"}], "]"}], "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Total", "[", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Norm", "[", 
                 RowBox[{"fij", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"j", ",", "1", ",", "Np"}], "}"}]}], "]"}], "]"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", "Np"}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"evac", "[", 
            RowBox[{"[", "step", "]"}], "]"}], "=", 
           RowBox[{"Length", "[", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"r", "[", 
               RowBox[{"[", 
                RowBox[{";;", ",", "1"}], "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"#", "\[GreaterEqual]", "11.0"}], "&"}]}], "]"}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tpressure", "[", 
            RowBox[{"[", 
             RowBox[{"step", "-", "1"}], "]"}], "]"}], "=", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"step", "<", "10"}], ",", "0", ",", 
             RowBox[{"Min", "[", 
              RowBox[{
               RowBox[{"Total", "[", 
                RowBox[{"pressure", "[", 
                 RowBox[{"[", 
                  RowBox[{"step", "-", "1"}], "]"}], "]"}], "]"}], ",", 
               RowBox[{"1800", "Np"}]}], "]"}]}], "]"}]}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"t", ",", "dt", ",", "cutoff", ",", "dt"}], "}"}]}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pressure", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "=", 
        RowBox[{"pressure", "[", 
         RowBox[{"[", 
          RowBox[{"-", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tpressure", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "=", 
        RowBox[{"tpressure", "[", 
         RowBox[{"[", 
          RowBox[{"-", "2"}], "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", "initialize", " ", "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"W", ",", "Wg", ",", "bb", ",", "door"}], "}"}], "=", 
     RowBox[{"wallgen", "[", 
      RowBox[{"lo", ",", "par1", ",", "par2"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"rad", "=", 
     RowBox[{"RandomReal", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"radmin", ",", "radmax"}], "}"}], ",", "Np"}], "]"}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"radsum", "=", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"0", ",", 
       RowBox[{"{", 
        RowBox[{"Np", ",", "Np"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Do", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"radsum", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
         RowBox[{
          RowBox[{"radsum", "[", 
           RowBox[{"[", 
            RowBox[{"j", ",", "i"}], "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{"rad", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "+", 
           RowBox[{"rad", "[", 
            RowBox[{"[", "j", "]"}], "]"}]}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"j", ",", "1", ",", "i"}], "}"}]}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", "Np"}], "}"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"r", "=", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"RandomReal", "[", 
         RowBox[{
          RowBox[{"bb", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", "Np"}], "]"}], ",", 
        RowBox[{"RandomReal", "[", 
         RowBox[{
          RowBox[{"bb", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "Np"}], "]"}]}], "}"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"v", "=", 
     RowBox[{"dvi", "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{"Np", ",", "2"}], "}"}]}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dij", "=", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"0", ",", 
       RowBox[{"{", 
        RowBox[{"Np", ",", "Np"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nij", "=", 
     RowBox[{"tij", "=", 
      RowBox[{"dvijt", "=", 
       RowBox[{"e0", "=", 
        RowBox[{"fij", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"Np", ",", "Np", ",", "2"}], "}"}]}], "]"}]}]}]}]}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"niw", "=", 
     RowBox[{"tiw", "=", 
      RowBox[{"fiw", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"{", 
          RowBox[{"Np", ",", "Nw", ",", "2"}], "}"}]}], "]"}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"diw", "=", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"0", ",", 
       RowBox[{"{", 
        RowBox[{"Np", ",", "Nw"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pressure", "=", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"0", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"Floor", "[", 
           FractionBox["cutoff", "dt"], "]"}], "+", "1"}], ",", "Np"}], 
        "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pos", "=", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"0", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"Floor", "[", 
           FractionBox["cutoff", "dt"], "]"}], "+", "1"}], ",", "Np", ",", 
         "2"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"evac", "=", 
     RowBox[{"tpressure", "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", 
        RowBox[{
         RowBox[{"Floor", "[", 
          FractionBox["cutoff", "dt"], "]"}], "+", "1"}]}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"pos", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "=", "r"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"restart", "[", "]"}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.7766008761831923`*^9, 3.776600882799075*^9}, 
   3.776717606385376*^9},
 CellLabel->"In[92]:=",ExpressionUUID->"2f5e6682-5c0a-465e-978f-d3a55a8c4b4d"],

Cell[BoxData[
 TemplateBox[{
  "General", "munfl", 
   "\"\\!\\(\\*RowBox[{\\\"Exp\\\", \\\"[\\\", RowBox[{\\\"-\\\", \
\\\"12417.495441347506`\\\"}], \\\"]\\\"}]\\) is too small to represent as a \
normalized machine number; precision may be lost.\"", 2, 179, 57, 
   25608580912527282027, "Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.8743587529948845`*^9, 3.874358893543545*^9},
 CellLabel->
  "During evaluation of \
In[92]:=",ExpressionUUID->"b09e3058-9be4-4746-b01c-7888f51f4f2e"],

Cell[BoxData[
 TemplateBox[{
  "General", "munfl", 
   "\"\\!\\(\\*RowBox[{\\\"Exp\\\", \\\"[\\\", RowBox[{\\\"-\\\", \
\\\"12477.528100176865`\\\"}], \\\"]\\\"}]\\) is too small to represent as a \
normalized machine number; precision may be lost.\"", 2, 179, 58, 
   25608580912527282027, "Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.8743587529948845`*^9, 3.8743588935445423`*^9},
 CellLabel->
  "During evaluation of \
In[92]:=",ExpressionUUID->"4d39a3a6-5c92-438a-9ca4-4448bbeb5846"],

Cell[BoxData[
 TemplateBox[{
  "General", "munfl", 
   "\"\\!\\(\\*RowBox[{\\\"Exp\\\", \\\"[\\\", RowBox[{\\\"-\\\", \
\\\"12466.452468280637`\\\"}], \\\"]\\\"}]\\) is too small to represent as a \
normalized machine number; precision may be lost.\"", 2, 179, 59, 
   25608580912527282027, "Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.8743587529948845`*^9, 3.8743588935495296`*^9},
 CellLabel->
  "During evaluation of \
In[92]:=",ExpressionUUID->"a73ceac6-9de3-418c-b19b-b23dbdb893d0"],

Cell[BoxData[
 TemplateBox[{
  "General", "stop", 
   "\"Further output of \\!\\(\\*StyleBox[RowBox[{\\\"General\\\", \
\\\"::\\\", \\\"munfl\\\"}], \\\"MessageName\\\"]\\) will be suppressed \
during this calculation.\"", 2, 179, 60, 25608580912527282027, "Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.8743587529948845`*^9, 3.874358893553519*^9},
 CellLabel->
  "During evaluation of \
In[92]:=",ExpressionUUID->"67b477e6-c64c-417f-8b20-5877921ebd3c"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Demonstration", "Subsection",
 CellChangeTimes->{{3.7766008885632277`*^9, 
  3.7766008904796133`*^9}},ExpressionUUID->"69087369-9488-4a62-8dfc-\
622c1f384bf6"],

Cell[BoxData[
 RowBox[{"Manipulate", "[", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "step", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"step", "=", 
       RowBox[{"1", "+", 
        RowBox[{"Floor", "[", 
         FractionBox["t", "dt"], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Framed", "[", 
       RowBox[{"ListPlot", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"4.8", 
                 FractionBox["tee", "cutoff"]}], "+", "14.6"}], ",", 
               RowBox[{
                RowBox[{"2.5", 
                 FractionBox[
                  RowBox[{"evac", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    FractionBox["tee", "dt"], "+", "1"}], "]"}], "]"}], 
                  "Np"]}], "+", "0.2"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"tee", ",", "0", ",", "t", ",", "dt"}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"4.8", 
                 FractionBox["tee", "cutoff"]}], "+", "14.6"}], ",", 
               RowBox[{
                RowBox[{"2.5", 
                 FractionBox[
                  RowBox[{"tpressure", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    FractionBox["tee", "dt"], "+", "1"}], "]"}], "]"}], 
                  RowBox[{"1800", "Np"}]]}], "+", "0.2"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"tee", ",", "0", ",", "t", ",", "dt"}], "}"}]}], 
            "]"}]}], "}"}], ",", 
         RowBox[{"PlotStyle", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Directive", "[", 
             RowBox[{
              RowBox[{"Opacity", "[", "0.5", "]"}], ",", 
              RowBox[{"RGBColor", "[", 
               RowBox[{"0", ",", "0.8", ",", "0"}], "]"}]}], "]"}], ",", 
            RowBox[{"Directive", "[", 
             RowBox[{
              RowBox[{"Opacity", "[", "0.5", "]"}], ",", 
              RowBox[{"RGBColor", "[", 
               RowBox[{"1", ",", "0", ",", "0"}], "]"}]}], "]"}]}], "}"}]}], 
         ",", 
         RowBox[{"Joined", "\[Rule]", "True"}], ",", 
         RowBox[{"Prolog", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"RGBColor", "[", 
             RowBox[{"0.95", ",", "0.95", ",", "0.95"}], "]"}], ",", 
            RowBox[{"Rectangle", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"14.5", ",", "0.1"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"19.5", ",", "2.9"}], "}"}]}], "]"}]}], "}"}]}], ",", 
         RowBox[{"Epilog", "\[Rule]", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Text", "[", 
              RowBox[{
               RowBox[{"\"\<time = \>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{"PaddedForm", "[", 
                  RowBox[{"t", ",", 
                   RowBox[{"{", 
                    RowBox[{"3", ",", "1"}], "}"}]}], "]"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"19", ",", "9"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"1", ",", "0"}], "}"}]}], "]"}], "}"}], ",", "Wg", 
            ",", 
            RowBox[{"{", "Gray", "}"}], ",", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"layout", "\[NotEqual]", "1"}], ",", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"layout", "\[GreaterEqual]", "2"}], ",", 
                RowBox[{"Line", "/@", 
                 RowBox[{
                  RowBox[{"wallgen", "[", 
                   RowBox[{"layout", ",", 
                    RowBox[{"a1", " ", "Degree"}], ",", "p2"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                RowBox[{"Line", "/@", 
                 RowBox[{
                  RowBox[{"wallgen", "[", 
                   RowBox[{"layout", ",", "p1", ",", "p2"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Line", "[", 
                 RowBox[{
                  RowBox[{"wallgen", "[", 
                   RowBox[{"1", ",", "p1", ",", "p2"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", 
                    RowBox[{"1", ";;", "6"}]}], "]"}], "]"}], "]"}], ",", 
                RowBox[{"Circle", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"wallgen", "[", 
                    RowBox[{"1", ",", "p1", ",", "p2"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "7"}], "]"}], "]"}], ",", "colrad"}], 
                 "]"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"Riffle", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"colmap", "[", 
                 RowBox[{"pressure", "[", 
                  RowBox[{"[", 
                   RowBox[{"step", ",", "i"}], "]"}], "]"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", "Np"}], "}"}]}], "]"}], ",", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Disk", "[", 
                 RowBox[{
                  RowBox[{"pos", "[", 
                   RowBox[{"[", 
                    RowBox[{"step", ",", "i"}], "]"}], "]"}], ",", 
                  RowBox[{"rad", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", "Np"}], "}"}]}], "]"}]}], "]"}], 
            ",", 
            RowBox[{"{", "}"}]}], "]"}]}], ",", 
         RowBox[{"PlotRange", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "20"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "10"}], "}"}]}], "}"}]}], ",", 
         RowBox[{"Axes", "\[Rule]", "False"}], ",", 
         RowBox[{"AspectRatio", "\[Rule]", 
          FractionBox["1", "2"]}]}], "]"}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}], ",", 
   RowBox[{"Style", "[", 
    RowBox[{"\"\<animation controls\>\"", ",", "14", ",", "Bold"}], "]"}], 
   ",", 
   RowBox[{"Row", "[", 
    RowBox[{"{", 
     RowBox[{"\"\<\>\"", ",", 
      RowBox[{"Button", "[", 
       RowBox[{"\"\<apply changes\>\"", ",", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"lo", "=", "layout"}], ";", "\[IndentingNewLine]", 
           RowBox[{"v0", "=", "v00"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Ap", "=", "Ap0"}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Aw", "=", "Aw0"}], ";"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"\[Kappa]", "=", "\[Kappa]0"}], ";", "\[IndentingNewLine]", 
           RowBox[{"restart", "[", 
            RowBox[{"layout", ",", "np", ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"layout", "<", "2"}], ",", "p1", ",", 
               RowBox[{"a1", " ", "Degree"}]}], "]"}], ",", "p2"}], "]"}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"lo", "=", "layout"}], ";", "\[IndentingNewLine]", 
           RowBox[{"t", "=", "0.0"}], ";"}]}], "]"}]}], "]"}]}], "}"}], "]"}],
    ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"t", ",", "0.0", ",", "\"\<time\>\""}], "}"}], ",", "0.0", ",", 
     "cutoff", ",", "dt", ",", "Animator", ",", 
     RowBox[{"AppearanceElements", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
       "\"\<ProgressSlider\>\"", ",", "\"\<ResetButton\>\"", ",", 
        "\"\<PlayPauseButton\>\"", ",", "\"\<FasterSlowerButtons\>\""}], 
       "}"}]}], ",", 
     RowBox[{"AnimationRate", "\[Rule]", "1.0"}]}], "}"}], ",", "Delimiter", 
   ",", 
   RowBox[{"Style", "[", 
    RowBox[{"\"\<room options\>\"", ",", "14", ",", "Bold"}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"layout", ",", "0", ",", "\"\<room layout\>\""}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"0", "\[Rule]", "\"\<single door\>\""}], ",", 
       RowBox[{"1", "\[Rule]", "\"\<column and door\>\""}], ",", 
       RowBox[{"2", "\[Rule]", "\"\<hallway with bulge\>\""}]}], "}"}], ",", 
     RowBox[{"ControlType", "\[Rule]", "PopupMenu"}]}], "}"}], ",", 
   RowBox[{"PaneSelector", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"0", "\[Rule]", 
        RowBox[{"Column", "[", 
         RowBox[{"{", 
          RowBox[{"Control", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"p1", ",", "1.5", ",", "\"\<door width\>\""}], "}"}], 
             ",", "1.0", ",", "4.0", ",", "0.05", ",", 
             RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], 
           "]"}], "}"}], "]"}]}], ",", 
       RowBox[{"1", "\[Rule]", 
        RowBox[{"Column", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Control", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"p1", ",", "1.5", ",", "\"\<door width\>\""}], "}"}], 
              ",", "1.0", ",", "3.0", ",", "0.05", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], 
            "]"}], ",", 
           RowBox[{"Control", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"p2", ",", "2.0", ",", "\"\<column spacing\>\""}], 
               "}"}], ",", "1.5", ",", "4.0", ",", "0.05", ",", 
              RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], 
            "]"}]}], "}"}], "]"}]}], ",", 
       RowBox[{"2", "\[Rule]", 
        RowBox[{"Column", "[", 
         RowBox[{"{", 
          RowBox[{"Control", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"a1", ",", "30", ",", "\"\<angle\>\""}], "}"}], ",", 
             "0", ",", "45", ",", "5", ",", 
             RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], 
           "]"}], "}"}], "]"}]}]}], "}"}], ",", 
     RowBox[{"Dynamic", "[", "layout", "]"}]}], "]"}], ",", "Delimiter", ",", 
   RowBox[{"Style", "[", 
    RowBox[{"\"\<simulation options\>\"", ",", "14", ",", "Bold"}], "]"}], 
   ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"np", ",", "20", ",", "\"\<crowd size\>\""}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"20", ",", "30", ",", "40", ",", "50"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"v00", ",", "1.0", ",", "\"\<pedestrian speed\>\""}], "}"}], 
     ",", "0.4", ",", "1.8", ",", "0.1", ",", 
     RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Ap0", ",", "2000", ",", "\"\<pedestrian repulsion\>\""}], 
      "}"}], ",", "0", ",", "5000", ",", "100", ",", 
     RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\[Kappa]0", ",", "240000", ",", "\"\<sliding friction\>\""}], 
      "}"}], ",", "0", ",", "500000", ",", "1000", ",", 
     RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], ",", 
   RowBox[{"ControlPlacement", "\[Rule]", "Left"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.7766008920271177`*^9, 3.7766008970415297`*^9}, 
   3.7767176551625347`*^9, {3.776719501225093*^9, 3.776719512839566*^9}, {
   3.7767202653972273`*^9, 3.776720273506*^9}},
 CellLabel->
  "In[180]:=",ExpressionUUID->"33c09147-0678-4904-9788-86b06fab5212"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{975, 573},
WindowMargins->{{61, Automatic}, {Automatic, 54}},
FrontEndVersion->"12.2 for Microsoft Windows (64-bit) (December 12, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"93892acf-9e2a-4713-839a-09c49f161387"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 319, 5, 96, "Title",ExpressionUUID->"9805899a-93c0-4bc4-9545-29f957ca3701"],
Cell[902, 29, 217, 4, 34, "Text",ExpressionUUID->"5c85a689-ec56-4fd6-a6a0-10104880b1a6"],
Cell[CellGroupData[{
Cell[1144, 37, 159, 3, 67, "Section",ExpressionUUID->"df1c84b3-b1e1-4f24-abd9-57ce7640212f"],
Cell[1306, 42, 222, 4, 34, "Text",ExpressionUUID->"2db01df3-4a50-4871-bf2e-a82f32323fdc"],
Cell[1531, 48, 372, 10, 34, "Text",ExpressionUUID->"f51dcc4f-94c0-4737-803e-0cdc6a17e919"],
Cell[1906, 60, 541, 9, 56, "Text",ExpressionUUID->"54748ff5-887e-4436-85f5-117a32376125"],
Cell[2450, 71, 761, 12, 122, "Text",ExpressionUUID->"d23009bc-4c8e-4b0e-b829-f5f80bcaf679"],
Cell[3214, 85, 821, 13, 122, "Text",ExpressionUUID->"9a797aee-a68f-4739-ac0b-aeaad9fb9810"]
}, Open  ]],
Cell[CellGroupData[{
Cell[4072, 103, 156, 3, 67, "Section",ExpressionUUID->"5df14828-0346-4594-be8c-36a8fe364a93"],
Cell[CellGroupData[{
Cell[4253, 110, 158, 3, 53, "Subsection",ExpressionUUID->"c8837db3-3e26-4009-a6c1-fa94a6130bfc"],
Cell[4414, 115, 8891, 277, 553, "Text",ExpressionUUID->"86acbcdb-3236-4447-b19c-8f67ddabbf86"]
}, Open  ]],
Cell[CellGroupData[{
Cell[13342, 397, 168, 3, 53, "Subsection",ExpressionUUID->"906c993f-7cf7-413d-8a1f-5764b1bb7ebc"],
Cell[13513, 402, 2107, 71, 187, "Text",ExpressionUUID->"9d4489d2-30b4-47b8-a5cb-ac898d8d73ba"]
}, Open  ]],
Cell[CellGroupData[{
Cell[15657, 478, 164, 3, 53, "Subsection",ExpressionUUID->"38fa2ada-9ae7-40e1-992c-07925d72e6b4"],
Cell[15824, 483, 511, 14, 34, "Text",ExpressionUUID->"9c3fc9b8-2227-4d89-b23f-2eba5055ffc4"],
Cell[16338, 499, 1286, 42, 56, "DisplayFormula",ExpressionUUID->"476f0db7-f658-40b0-8456-20e2388a2684"],
Cell[17627, 543, 682, 20, 42, "Text",ExpressionUUID->"be2ad82a-18c6-43de-824a-066330ce0dde"],
Cell[18312, 565, 459, 14, 34, "Text",ExpressionUUID->"f8e71323-1420-43c0-889b-61c038512d3d"],
Cell[18774, 581, 490, 16, 46, "DisplayFormula",ExpressionUUID->"2297ce7e-ad0c-49bb-89cc-15ebe768734f"],
Cell[19267, 599, 219, 4, 34, "Text",ExpressionUUID->"27bb1d89-aa33-497d-a3ed-775fa0567c66"],
Cell[19489, 605, 988, 31, 105, "DisplayFormula",ExpressionUUID->"74a13510-27b7-4b2e-b970-c1cba9be9a33"],
Cell[20480, 638, 758, 18, 58, "Text",ExpressionUUID->"f5464920-0990-4933-9e3e-3087e58b7bf4"],
Cell[21241, 658, 781, 24, 53, "DisplayFormula",ExpressionUUID->"a8b61a64-4296-4b0c-a594-b71a36b83542"],
Cell[22025, 684, 289, 7, 34, "Text",ExpressionUUID->"826c2e89-5728-4ebf-909b-c41834b2f0d8"],
Cell[22317, 693, 899, 29, 55, "DisplayFormula",ExpressionUUID->"dd0628b3-3d8c-45a8-bffc-bdfaaa3acd53"],
Cell[23219, 724, 506, 15, 34, "Text",ExpressionUUID->"2b97b23d-bf2b-4737-a826-f730d657448b"],
Cell[23728, 741, 1154, 37, 46, "DisplayFormula",ExpressionUUID->"40a6e0fe-eacb-47ec-b7af-7ef89d5f21d8"],
Cell[24885, 780, 340, 10, 34, "Text",ExpressionUUID->"27af105f-0e3e-44b4-876e-c0b6aba120cc"],
Cell[25228, 792, 1285, 41, 46, "DisplayFormula",ExpressionUUID->"eec56e71-4a0a-4d6f-b2ed-75bfd7154370"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[26562, 839, 151, 3, 67, "Section",ExpressionUUID->"aeb228d4-d089-4e83-b31d-cbd4c77d28f7"],
Cell[CellGroupData[{
Cell[26738, 846, 162, 3, 53, "Subsection",ExpressionUUID->"b64501da-8566-4995-b532-6f4664e4d563"],
Cell[CellGroupData[{
Cell[26925, 853, 98546, 2536, 9705, "Input",ExpressionUUID->"2f5e6682-5c0a-465e-978f-d3a55a8c4b4d"],
Cell[125474, 3391, 512, 11, 70, "Message",ExpressionUUID->"b09e3058-9be4-4746-b01c-7888f51f4f2e"],
Cell[125989, 3404, 514, 11, 70, "Message",ExpressionUUID->"4d39a3a6-5c92-438a-9ca4-4448bbeb5846"],
Cell[126506, 3417, 514, 11, 70, "Message",ExpressionUUID->"a73ceac6-9de3-418c-b19b-b23dbdb893d0"],
Cell[127023, 3430, 478, 10, 70, "Message",ExpressionUUID->"67b477e6-c64c-417f-8b20-5877921ebd3c"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[127550, 3446, 165, 3, 37, "Subsection",ExpressionUUID->"69087369-9488-4a62-8dfc-622c1f384bf6"],
Cell[127718, 3451, 12150, 297, 746, "Input",ExpressionUUID->"33c09147-0678-4904-9788-86b06fab5212"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

